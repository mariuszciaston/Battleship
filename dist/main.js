(()=>{"use strict";const t=()=>{const t=["A","B","C","D","E","F","G","H","I","J"],e=["1","2","3","4","5","6","7","8","9","10"],r=[],o=(o,n)=>{const a=t.indexOf(o),s=e.indexOf(n);return-1===a||-1===s?null:r[s][a]},n=(o,n,a,s)=>{const c=t.indexOf(o),i=e.indexOf(n);return-1===c||-1===i?null:(r[i][c].status=a,s&&(r[i][c].takenBy=s),r[i][c])};return(()=>{for(let o=0;o<10;o+=1){r[o]=[];for(let n=0;n<10;n+=1)r[o][n]={col:t[n],row:e[o],status:"empty",takenBy:void 0}}})(),{clearBoard:()=>{for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1)r[t][e].status="empty",r[t][e].takenBy=void 0},getCell:o,setCell:n,placeShip:(r,a,s,c)=>{const i="horizontal"===c,l=i?t:e,d=l.indexOf(i?a:s);if(d<0||d+r.size>l.length)return!1;for(let t=0;t<r.size;t+=1){const e=i?l[d+t]:a,c=i?s:l[d+t];if("empty"!==o(e,c).status)return!1;n(e,c,"taken",r)}return!0},receiveAttack:(t,e)=>{const r=o(t,e);return"taken"===r.status?(r.takenBy.hit(),n(t,e,"hit"),r.status):"empty"===r.status?(n(t,e,"miss"),r.status):null},sinkShip:(t,e,r)=>{const o=t.getCell(e,r);if(o&&o.takenBy&&o.takenBy.isSunk()){t.array.flat().filter((t=>t.takenBy&&t.takenBy.name===o.takenBy.name)).forEach((e=>{[{col:0,row:-1},{col:0,row:1},{col:-1,row:0},{col:1,row:0},{col:-1,row:-1},{col:-1,row:1},{col:1,row:-1},{col:1,row:1}].forEach((r=>{const o=String.fromCharCode(e.col.charCodeAt(0)+r.col),n=(Number(e.row)+r.row).toString();t.getCell(o,n)&&t.receiveAttack(o,n)}))}))}},allSunk:()=>{for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1)if("taken"===r[t][e].status&&!r[t][e].takenBy.isSunk())return!1;return!0},array:r}},e=t=>{let e,r=0;"Carrier"===t&&(e=5),"Battleship"===t&&(e=4),"Destroyer"===t&&(e=3),"Submarine"===t&&(e=3),"Patrol Boat"===t&&(e=2);return{name:t,size:e,hit:()=>{r+=1},isSunk:()=>r===e}},r=()=>({attack:(t,e,r)=>"hit"!==t.getCell(e,r).status&&"miss"!==t.getCell(e,r).status?t.receiveAttack(e,r):"already shot",randomAttack:t=>{const e=["A","B","C","D","E","F","G","H","I","J"];let r,o;do{r=e[Math.floor(Math.random()*e.length)],o=Math.ceil(10*Math.random()).toString()}while("hit"===t.getCell(r,o).status||"miss"===t.getCell(r,o).status);if("hit"!==t.getCell(r,o).status&&"miss"!==t.getCell(r,o).status){return{result:t.receiveAttack(r,o),col:r,row:o}}return{result:"already shot",col:r,row:o}}});var o=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function s(t){try{i(o.next(t))}catch(t){a(t)}}function c(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};const n=(()=>{const t=document.querySelector("#wrapper"),e=document.createElement("div");e.id="boards",t.append(e);const r=(t,e)=>{t.array.forEach((t=>{t.forEach((t=>{const r=(t=>{const e=document.createElement("div");return e.classList.add("cell"),e.classList.add(t.status),e.setAttribute("data-col",t.col),e.setAttribute("data-row",t.row),e})(t);e.append(r)}))}))},n=t=>{if(console.log(t.target),!t.target.classList.contains("hit")&&!t.target.classList.contains("miss")){return{col:t.target.getAttribute("data-col"),row:t.target.getAttribute("data-row")}}};return{renderBoard:t=>{const o=document.createElement("div");o.classList.add("board"),t===c?o.id="firstBoard":t===i&&(o.id="secondBoard"),r(t,o),e.append(o)},refreshBoard:t=>{const e=t===c?"firstBoard":"secondBoard",o=document.querySelector(`#${e}`);o.innerHTML="",r(t,o)},handleUserInput:function(){return o(this,void 0,void 0,(function*(){const t=document.querySelectorAll("#secondBoard .cell");let e;do{e=yield new Promise((e=>{t.forEach((t=>{t.classList.contains("hit")||t.classList.contains("miss")||t.addEventListener("click",(t=>{e(n(t))}),{once:!0})}))}))}while(!e);return{col:e.col.toString(),row:e.row.toString()}}))}}})(),a=n;var s=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function s(t){try{i(o.next(t))}catch(t){a(t)}}function c(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};const c=t(),i=t(),l=r(),d=r(),u=()=>{const t=e("Carrier"),r=e("Battleship"),o=e("Destroyer"),n=e("Submarine"),a=e("Patrol Boat"),s=e("Carrier"),l=e("Battleship"),d=e("Destroyer"),u=e("Submarine"),h=e("Patrol Boat");c.placeShip(t,"A","1","horizontal"),c.placeShip(r,"A","3","horizontal"),c.placeShip(o,"A","5","horizontal"),c.placeShip(n,"A","7","horizontal"),c.placeShip(a,"A","9","horizontal"),i.placeShip(s,"A","1","vertical"),i.placeShip(l,"C","1","vertical"),i.placeShip(d,"E","1","vertical"),i.placeShip(u,"G","1","vertical"),i.placeShip(h,"I","1","vertical")},h=()=>i.allSunk()?(console.log("All computer ships are sunk. Human player won!"),!0):!!c.allSunk()&&(console.log("All human ships are sunk. Computer player won!"),!0),f=document.querySelector("#playerVsComputer"),m=document.querySelector("#computerVsComputer");let p=!1;const y=()=>f.classList.contains("selected")?s(void 0,void 0,void 0,(function*(){for(;!h()&&f.classList.contains("selected")&&!p;){const{col:t,row:e}=yield a.handleUserInput();if(l.attack(i,t,e),i.sinkShip(i,t,e),a.refreshBoard(i),yield new Promise((t=>setTimeout(t,1e3))),!f.classList.contains("selected")||p)break;const{col:r,row:o}=d.randomAttack(c);c.sinkShip(c,r,o),a.refreshBoard(c)}p=!1})):m.classList.contains("selected")?s(void 0,void 0,void 0,(function*(){for(;!h()&&m.classList.contains("selected")&&!p&&(yield new Promise((t=>setTimeout(t,100))),m.classList.contains("selected")&&!p);){const{col:t,row:e}=d.randomAttack(c);if(c.sinkShip(c,t,e),a.refreshBoard(c),yield new Promise((t=>setTimeout(t,100))),!m.classList.contains("selected")||p)break;const{col:r,row:o}=l.randomAttack(i);i.sinkShip(i,r,o),a.refreshBoard(i)}p=!1})):void 0,k=()=>{c.clearBoard(),i.clearBoard(),u(),a.refreshBoard(c),a.refreshBoard(i),y()},w=document.querySelector("#newGame");w.addEventListener("click",(()=>s(void 0,void 0,void 0,(function*(){p=!0,w.disabled=!0,w.textContent="Restarting",yield new Promise((t=>setTimeout(t,1e3))),k(),w.textContent="New Game",w.disabled=!1})))),f.addEventListener("click",(()=>{m.classList.remove("selected"),f.classList.contains("selected")||(f.classList.add("selected"),k())})),m.addEventListener("click",(()=>{f.classList.remove("selected"),m.classList.contains("selected")||(m.classList.add("selected"),k())}));(()=>{u(),a.renderBoard(c),a.renderBoard(i),y()})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lYm9hcmQudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3NoaXAudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3BsYXllci50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvdWkudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2NvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvbHMgPSBbJ0EnLCAnQicsICdDJywgJ0QnLCAnRScsICdGJywgJ0cnLCAnSCcsICdJJywgJ0onXTtcbiAgICBjb25zdCByb3dzID0gWycxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsICcxMCddO1xuICAgIGNvbnN0IGFycmF5ID0gW107XG4gICAgY29uc3QgZ2VuZXJhdGVBcnJheSA9ICgpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSArPSAxKSB7XG4gICAgICAgICAgICBhcnJheVtpXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgYXJyYXlbaV1bal0gPSB7IGNvbDogY29sc1tqXSwgcm93OiByb3dzW2ldLCBzdGF0dXM6ICdlbXB0eScsIHRha2VuQnk6IHVuZGVmaW5lZCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBjbGVhckJvYXJkID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGFycmF5W2ldW2pdLnN0YXR1cyA9ICdlbXB0eSc7XG4gICAgICAgICAgICAgICAgYXJyYXlbaV1bal0udGFrZW5CeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZ2V0Q2VsbCA9IChjb2wsIHJvdykgPT4ge1xuICAgICAgICBjb25zdCBjb2xJbmRleCA9IGNvbHMuaW5kZXhPZihjb2wpO1xuICAgICAgICBjb25zdCByb3dJbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuICAgICAgICBpZiAoY29sSW5kZXggPT09IC0xIHx8IHJvd0luZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF07XG4gICAgfTtcbiAgICBjb25zdCBzZXRDZWxsID0gKGNvbCwgcm93LCBuZXdTdGF0dXMsIG5ld1Rha2VuQnkpID0+IHtcbiAgICAgICAgY29uc3QgY29sSW5kZXggPSBjb2xzLmluZGV4T2YoY29sKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcbiAgICAgICAgaWYgKGNvbEluZGV4ID09PSAtMSB8fCByb3dJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF0uc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICBpZiAobmV3VGFrZW5CeSkge1xuICAgICAgICAgICAgYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XS50YWtlbkJ5ID0gbmV3VGFrZW5CeTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XTtcbiAgICB9O1xuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb2wsIHJvdywgb3JpZW50YXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgaXNIb3Jpem9udGFsID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcbiAgICAgICAgY29uc3QgY2VsbHMgPSBpc0hvcml6b250YWwgPyBjb2xzIDogcm93cztcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBjZWxscy5pbmRleE9mKGlzSG9yaXpvbnRhbCA/IGNvbCA6IHJvdyk7XG4gICAgICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgKyBzaGlwLnNpemUgPiBjZWxscy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuc2l6ZTsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sID0gaXNIb3Jpem9udGFsID8gY2VsbHNbc3RhcnQgKyBpXSA6IGNvbDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBpc0hvcml6b250YWwgPyByb3cgOiBjZWxsc1tzdGFydCArIGldO1xuICAgICAgICAgICAgaWYgKGdldENlbGwoY3VycmVudENvbCwgY3VycmVudFJvdykuc3RhdHVzICE9PSAnZW1wdHknKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0Q2VsbChjdXJyZW50Q29sLCBjdXJyZW50Um93LCAndGFrZW4nLCBzaGlwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29sLCByb3cpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdldENlbGwoY29sLCByb3cpO1xuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICd0YWtlbicpIHtcbiAgICAgICAgICAgIGNlbGwudGFrZW5CeS5oaXQoKTtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdoaXQnKTtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLnN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICdlbXB0eScpIHtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdtaXNzJyk7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5zdGF0dXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICBjb25zdCBzaW5rU2hpcCA9IChnYW1lYm9hcmQsIGNvbCwgcm93KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBnYW1lYm9hcmQuZ2V0Q2VsbChjb2wsIHJvdyk7XG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwudGFrZW5CeSAmJiBjZWxsLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXBDZWxscyA9IGdhbWVib2FyZC5hcnJheS5mbGF0KCkuZmlsdGVyKChjKSA9PiBjLnRha2VuQnkgJiYgYy50YWtlbkJ5Lm5hbWUgPT09IGNlbGwudGFrZW5CeS5uYW1lKTtcbiAgICAgICAgICAgIHNoaXBDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogLTEgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMCB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgY29sOiAtMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAxIH0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25zLmZvckVhY2goKGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2wgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNlbGwuY29sLmNoYXJDb2RlQXQoMCkgKyBkaXJlY3Rpb24uY29sKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Um93ID0gKE51bWJlcihjZWxsLnJvdykgKyBkaXJlY3Rpb24ucm93KS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwobmV3Q29sLCBuZXdSb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhuZXdDb2wsIG5ld1Jvdyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBhbGxTdW5rID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGlmIChhcnJheVtpXVtqXS5zdGF0dXMgPT09ICd0YWtlbicgJiYgIWFycmF5W2ldW2pdLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGdlbmVyYXRlQXJyYXkoKTtcbiAgICByZXR1cm4geyBjbGVhckJvYXJkLCBnZXRDZWxsLCBzZXRDZWxsLCBwbGFjZVNoaXAsIHJlY2VpdmVBdHRhY2ssIHNpbmtTaGlwLCBhbGxTdW5rLCBhcnJheSB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZEZhY3Rvcnk7XG4iLCJjb25zdCBzaGlwRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gICAgbGV0IGhpdENvdW50ZXIgPSAwO1xuICAgIGxldCBzaXplO1xuICAgIGlmIChuYW1lID09PSAnQ2FycmllcicpIHtcbiAgICAgICAgc2l6ZSA9IDU7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnQmF0dGxlc2hpcCcpIHtcbiAgICAgICAgc2l6ZSA9IDQ7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnRGVzdHJveWVyJykge1xuICAgICAgICBzaXplID0gMztcbiAgICB9XG4gICAgaWYgKG5hbWUgPT09ICdTdWJtYXJpbmUnKSB7XG4gICAgICAgIHNpemUgPSAzO1xuICAgIH1cbiAgICBpZiAobmFtZSA9PT0gJ1BhdHJvbCBCb2F0Jykge1xuICAgICAgICBzaXplID0gMjtcbiAgICB9XG4gICAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgICAgICBoaXRDb3VudGVyICs9IDE7XG4gICAgfTtcbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgICAgIGlmIChoaXRDb3VudGVyID09PSBzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4geyBuYW1lLCBzaXplLCBoaXQsIGlzU3VuayB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IHNoaXBGYWN0b3J5O1xuIiwiY29uc3QgcGxheWVyRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBhdHRhY2sgPSAoZ2FtZWJvYXJkLCBjb2wsIHJvdykgPT4ge1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29sLCByb3cpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnYWxyZWFkeSBzaG90JztcbiAgICB9O1xuICAgIGNvbnN0IHJhbmRvbUF0dGFjayA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgY29scyA9IFsnQScsICdCJywgJ0MnLCAnRCcsICdFJywgJ0YnLCAnRycsICdIJywgJ0knLCAnSiddO1xuICAgICAgICBsZXQgcmFuZG9tQ29sO1xuICAgICAgICBsZXQgcmFuZG9tUm93O1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICByYW5kb21Db2wgPSBjb2xzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNvbHMubGVuZ3RoKV07XG4gICAgICAgICAgICByYW5kb21Sb3cgPSBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwKS50b1N0cmluZygpO1xuICAgICAgICB9IHdoaWxlIChnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnaGl0JyB8fCBnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnbWlzcycpO1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhyYW5kb21Db2wsIHJhbmRvbVJvdyk7XG4gICAgICAgICAgICByZXR1cm4geyByZXN1bHQsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogJ2FscmVhZHkgc2hvdCcsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgIH07XG4gICAgcmV0dXJuIHsgYXR0YWNrLCByYW5kb21BdHRhY2sgfTtcbn07XG5leHBvcnQgZGVmYXVsdCBwbGF5ZXJGYWN0b3J5O1xuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5pbXBvcnQgeyBodW1hbkdhbWVib2FyZCwgY29tcHV0ZXJHYW1lYm9hcmQgfSBmcm9tICcuL2NvbnRyb2xsZXInO1xuY29uc3QgdWkgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3JhcHBlcicpO1xuICAgIGNvbnN0IGJvYXJkcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJvYXJkcy5pZCA9ICdib2FyZHMnO1xuICAgIHdyYXBwZXIuYXBwZW5kKGJvYXJkcyk7XG4gICAgY29uc3QgY3JlYXRlQ2VsbCA9IChjb2wpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2NlbGwnKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKGNvbC5zdGF0dXMpO1xuICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1jb2wnLCBjb2wuY29sKTtcbiAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcm93JywgY29sLnJvdyk7XG4gICAgICAgIHJldHVybiBjZWxsO1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyQ2VsbHMgPSAoZ2FtZWJvYXJkLCBib2FyZCkgPT4ge1xuICAgICAgICBnYW1lYm9hcmQuYXJyYXkuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICAgICAgICByb3cuZm9yRWFjaCgoY29sKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGNyZWF0ZUNlbGwoY29sKTtcbiAgICAgICAgICAgICAgICBib2FyZC5hcHBlbmQoY2VsbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJCb2FyZCA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgYm9hcmQuY2xhc3NMaXN0LmFkZCgnYm9hcmQnKTtcbiAgICAgICAgaWYgKGdhbWVib2FyZCA9PT0gaHVtYW5HYW1lYm9hcmQpIHtcbiAgICAgICAgICAgIGJvYXJkLmlkID0gJ2ZpcnN0Qm9hcmQnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdhbWVib2FyZCA9PT0gY29tcHV0ZXJHYW1lYm9hcmQpIHtcbiAgICAgICAgICAgIGJvYXJkLmlkID0gJ3NlY29uZEJvYXJkJztcbiAgICAgICAgfVxuICAgICAgICByZW5kZXJDZWxscyhnYW1lYm9hcmQsIGJvYXJkKTtcbiAgICAgICAgYm9hcmRzLmFwcGVuZChib2FyZCk7XG4gICAgfTtcbiAgICBjb25zdCByZWZyZXNoQm9hcmQgPSAoZ2FtZWJvYXJkKSA9PiB7XG4gICAgICAgIGNvbnN0IGJvYXJkSWQgPSBnYW1lYm9hcmQgPT09IGh1bWFuR2FtZWJvYXJkID8gJ2ZpcnN0Qm9hcmQnIDogJ3NlY29uZEJvYXJkJztcbiAgICAgICAgY29uc3QgYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtib2FyZElkfWApO1xuICAgICAgICBib2FyZC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgcmVuZGVyQ2VsbHMoZ2FtZWJvYXJkLCBib2FyZCk7XG4gICAgfTtcbiAgICBjb25zdCBnZXRVc2VySW5wdXQgPSAoZSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7XG4gICAgICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaXQnKSAmJiAhZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtaXNzJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbCA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2wnKTtcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3cnKTtcbiAgICAgICAgICAgIHJldHVybiB7IGNvbCwgcm93IH07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGZ1bmN0aW9uIGhhbmRsZVVzZXJJbnB1dCgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3NlY29uZEJvYXJkIC5jZWxsJyk7XG4gICAgICAgICAgICBsZXQgdXNlcklucHV0O1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIHVzZXJJbnB1dCA9IHlpZWxkIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2VsbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpdCcpICYmICFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnbWlzcycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZ2V0VXNlcklucHV0KGUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7IG9uY2U6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSB3aGlsZSAoIXVzZXJJbnB1dCk7XG4gICAgICAgICAgICBjb25zdCBjb2wgPSB1c2VySW5wdXQuY29sLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCByb3cgPSB1c2VySW5wdXQucm93LnRvU3RyaW5nKCk7XG4gICAgICAgICAgICByZXR1cm4geyBjb2wsIHJvdyB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHsgcmVuZGVyQm9hcmQsIHJlZnJlc2hCb2FyZCwgaGFuZGxlVXNlcklucHV0IH07XG59KSgpO1xuZXhwb3J0IGRlZmF1bHQgdWk7XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCBnYW1lYm9hcmRGYWN0b3J5IGZyb20gJy4vZ2FtZWJvYXJkJztcbmltcG9ydCBzaGlwRmFjdG9yeSBmcm9tICcuL3NoaXAnO1xuaW1wb3J0IHBsYXllckZhY3RvcnkgZnJvbSAnLi9wbGF5ZXInO1xuaW1wb3J0IHVpIGZyb20gJy4vdWknO1xuY29uc3QgaHVtYW5HYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG5jb25zdCBjb21wdXRlckdhbWVib2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbmNvbnN0IGh1bWFuID0gcGxheWVyRmFjdG9yeSgpO1xuY29uc3QgY29tcHV0ZXIgPSBwbGF5ZXJGYWN0b3J5KCk7XG5jb25zdCBwb3B1bGF0ZUdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBodW1hbkNhcnJpZXIgPSBzaGlwRmFjdG9yeSgnQ2FycmllcicpO1xuICAgIGNvbnN0IGh1bWFuQmF0dGxlc2hpcCA9IHNoaXBGYWN0b3J5KCdCYXR0bGVzaGlwJyk7XG4gICAgY29uc3QgaHVtYW5EZXN0cm95ZXIgPSBzaGlwRmFjdG9yeSgnRGVzdHJveWVyJyk7XG4gICAgY29uc3QgaHVtYW5TdWJtYXJpbmUgPSBzaGlwRmFjdG9yeSgnU3VibWFyaW5lJyk7XG4gICAgY29uc3QgaHVtYW5QYXRyb2xib2F0ID0gc2hpcEZhY3RvcnkoJ1BhdHJvbCBCb2F0Jyk7XG4gICAgY29uc3QgY29tcHV0ZXJDYXJyaWVyID0gc2hpcEZhY3RvcnkoJ0NhcnJpZXInKTtcbiAgICBjb25zdCBjb21wdXRlckJhdHRsZXNoaXAgPSBzaGlwRmFjdG9yeSgnQmF0dGxlc2hpcCcpO1xuICAgIGNvbnN0IGNvbXB1dGVyRGVzdHJveWVyID0gc2hpcEZhY3RvcnkoJ0Rlc3Ryb3llcicpO1xuICAgIGNvbnN0IGNvbXB1dGVyU3VibWFyaW5lID0gc2hpcEZhY3RvcnkoJ1N1Ym1hcmluZScpO1xuICAgIGNvbnN0IGNvbXB1dGVyUGF0cm9sYm9hdCA9IHNoaXBGYWN0b3J5KCdQYXRyb2wgQm9hdCcpO1xuICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hbkNhcnJpZXIsICdBJywgJzEnLCAnaG9yaXpvbnRhbCcpO1xuICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hbkJhdHRsZXNoaXAsICdBJywgJzMnLCAnaG9yaXpvbnRhbCcpO1xuICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hbkRlc3Ryb3llciwgJ0EnLCAnNScsICdob3Jpem9udGFsJyk7XG4gICAgaHVtYW5HYW1lYm9hcmQucGxhY2VTaGlwKGh1bWFuU3VibWFyaW5lLCAnQScsICc3JywgJ2hvcml6b250YWwnKTtcbiAgICBodW1hbkdhbWVib2FyZC5wbGFjZVNoaXAoaHVtYW5QYXRyb2xib2F0LCAnQScsICc5JywgJ2hvcml6b250YWwnKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoY29tcHV0ZXJDYXJyaWVyLCAnQScsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKGNvbXB1dGVyQmF0dGxlc2hpcCwgJ0MnLCAnMScsICd2ZXJ0aWNhbCcpO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlckRlc3Ryb3llciwgJ0UnLCAnMScsICd2ZXJ0aWNhbCcpO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlclN1Ym1hcmluZSwgJ0cnLCAnMScsICd2ZXJ0aWNhbCcpO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlclBhdHJvbGJvYXQsICdJJywgJzEnLCAndmVydGljYWwnKTtcbn07XG5jb25zdCBpc0dhbWVPdmVyID0gKCkgPT4ge1xuICAgIGlmIChjb21wdXRlckdhbWVib2FyZC5hbGxTdW5rKCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FsbCBjb21wdXRlciBzaGlwcyBhcmUgc3Vuay4gSHVtYW4gcGxheWVyIHdvbiEnKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChodW1hbkdhbWVib2FyZC5hbGxTdW5rKCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FsbCBodW1hbiBzaGlwcyBhcmUgc3Vuay4gQ29tcHV0ZXIgcGxheWVyIHdvbiEnKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG5jb25zdCBwbGF5ZXJWc0NvbXB1dGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsYXllclZzQ29tcHV0ZXInKTtcbmNvbnN0IGNvbXB1dGVyVnNDb21wdXRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjb21wdXRlclZzQ29tcHV0ZXInKTtcbmxldCBpc1N0b3BwZWQgPSBmYWxzZTtcbmNvbnN0IHBsYXllclZzQ29tcHV0ZXJNb2RlID0gKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgd2hpbGUgKCFpc0dhbWVPdmVyKCkgJiYgcGxheWVyVnNDb21wdXRlci5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykgJiYgIWlzU3RvcHBlZCkge1xuICAgICAgICBjb25zdCB7IGNvbCwgcm93IH0gPSB5aWVsZCB1aS5oYW5kbGVVc2VySW5wdXQoKTtcbiAgICAgICAgaHVtYW4uYXR0YWNrKGNvbXB1dGVyR2FtZWJvYXJkLCBjb2wsIHJvdyk7XG4gICAgICAgIGNvbXB1dGVyR2FtZWJvYXJkLnNpbmtTaGlwKGNvbXB1dGVyR2FtZWJvYXJkLCBjb2wsIHJvdyk7XG4gICAgICAgIHVpLnJlZnJlc2hCb2FyZChjb21wdXRlckdhbWVib2FyZCk7XG4gICAgICAgIHlpZWxkIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgICAgaWYgKCFwbGF5ZXJWc0NvbXB1dGVyLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSB8fCBpc1N0b3BwZWQpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgY29sOiByYW5kb21Db2wsIHJvdzogcmFuZG9tUm93IH0gPSBjb21wdXRlci5yYW5kb21BdHRhY2soaHVtYW5HYW1lYm9hcmQpO1xuICAgICAgICBodW1hbkdhbWVib2FyZC5zaW5rU2hpcChodW1hbkdhbWVib2FyZCwgcmFuZG9tQ29sLCByYW5kb21Sb3cpO1xuICAgICAgICB1aS5yZWZyZXNoQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgIH1cbiAgICBpc1N0b3BwZWQgPSBmYWxzZTtcbn0pO1xuY29uc3QgY29tcHV0ZXJWc0NvbXB1dGVyTW9kZSA9ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHdoaWxlICghaXNHYW1lT3ZlcigpICYmIGNvbXB1dGVyVnNDb21wdXRlci5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykgJiYgIWlzU3RvcHBlZCkge1xuICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgaWYgKCFjb21wdXRlclZzQ29tcHV0ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpIHx8IGlzU3RvcHBlZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBjb2w6IHJhbmRvbUNvbDIsIHJvdzogcmFuZG9tUm93MiB9ID0gY29tcHV0ZXIucmFuZG9tQXR0YWNrKGh1bWFuR2FtZWJvYXJkKTtcbiAgICAgICAgaHVtYW5HYW1lYm9hcmQuc2lua1NoaXAoaHVtYW5HYW1lYm9hcmQsIHJhbmRvbUNvbDIsIHJhbmRvbVJvdzIpO1xuICAgICAgICB1aS5yZWZyZXNoQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgaWYgKCFjb21wdXRlclZzQ29tcHV0ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpIHx8IGlzU3RvcHBlZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBjb2w6IHJhbmRvbUNvbDEsIHJvdzogcmFuZG9tUm93MSB9ID0gaHVtYW4ucmFuZG9tQXR0YWNrKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICAgICAgY29tcHV0ZXJHYW1lYm9hcmQuc2lua1NoaXAoY29tcHV0ZXJHYW1lYm9hcmQsIHJhbmRvbUNvbDEsIHJhbmRvbVJvdzEpO1xuICAgICAgICB1aS5yZWZyZXNoQm9hcmQoY29tcHV0ZXJHYW1lYm9hcmQpO1xuICAgIH1cbiAgICBpc1N0b3BwZWQgPSBmYWxzZTtcbn0pO1xuY29uc3QgZ2V0R2FtZU1vZGUgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclZzQ29tcHV0ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgIHJldHVybiBwbGF5ZXJWc0NvbXB1dGVyTW9kZSgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb21wdXRlclZzQ29tcHV0ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgIHJldHVybiBjb21wdXRlclZzQ29tcHV0ZXJNb2RlKCk7XG4gICAgfVxufTtcbmNvbnN0IHN0YXJ0ID0gKCkgPT4ge1xuICAgIHBvcHVsYXRlR2FtZWJvYXJkKCk7XG4gICAgdWkucmVuZGVyQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgIHVpLnJlbmRlckJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICBnZXRHYW1lTW9kZSgpO1xufTtcbmNvbnN0IHJlc3RhcnQgPSAoKSA9PiB7XG4gICAgaHVtYW5HYW1lYm9hcmQuY2xlYXJCb2FyZCgpO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLmNsZWFyQm9hcmQoKTtcbiAgICBwb3B1bGF0ZUdhbWVib2FyZCgpO1xuICAgIHVpLnJlZnJlc2hCb2FyZChodW1hbkdhbWVib2FyZCk7XG4gICAgdWkucmVmcmVzaEJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICBnZXRHYW1lTW9kZSgpO1xufTtcbmNvbnN0IG5ld0dhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3R2FtZScpO1xubmV3R2FtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGlzU3RvcHBlZCA9IHRydWU7XG4gICAgbmV3R2FtZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgbmV3R2FtZS50ZXh0Q29udGVudCA9ICdSZXN0YXJ0aW5nJztcbiAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgcmVzdGFydCgpO1xuICAgIG5ld0dhbWUudGV4dENvbnRlbnQgPSAnTmV3IEdhbWUnO1xuICAgIG5ld0dhbWUuZGlzYWJsZWQgPSBmYWxzZTtcbn0pKTtcbnBsYXllclZzQ29tcHV0ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgY29tcHV0ZXJWc0NvbXB1dGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgaWYgKCFwbGF5ZXJWc0NvbXB1dGVyLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSkge1xuICAgICAgICBwbGF5ZXJWc0NvbXB1dGVyLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgIHJlc3RhcnQoKTtcbiAgICB9XG59KTtcbmNvbXB1dGVyVnNDb21wdXRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBwbGF5ZXJWc0NvbXB1dGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgaWYgKCFjb21wdXRlclZzQ29tcHV0ZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgIGNvbXB1dGVyVnNDb21wdXRlci5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfVxufSk7XG5leHBvcnQgeyBodW1hbkdhbWVib2FyZCwgY29tcHV0ZXJHYW1lYm9hcmQgfTtcbmV4cG9ydCBkZWZhdWx0IHN0YXJ0O1xuIiwiaW1wb3J0ICdub3JtYWxpemUuY3NzJztcbmltcG9ydCAnLi9zdHlsZS9zdHlsZS5jc3MnO1xuaW1wb3J0IHN0YXJ0IGZyb20gJy4vbW9kdWxlcy9jb250cm9sbGVyJztcbnN0YXJ0KCk7XG4iXSwibmFtZXMiOlsiY29scyIsInJvd3MiLCJhcnJheSIsImdldENlbGwiLCJjb2wiLCJyb3ciLCJjb2xJbmRleCIsImluZGV4T2YiLCJyb3dJbmRleCIsInNldENlbGwiLCJuZXdTdGF0dXMiLCJuZXdUYWtlbkJ5Iiwic3RhdHVzIiwidGFrZW5CeSIsImkiLCJqIiwidW5kZWZpbmVkIiwiZ2VuZXJhdGVBcnJheSIsImNsZWFyQm9hcmQiLCJwbGFjZVNoaXAiLCJzaGlwIiwib3JpZW50YXRpb24iLCJpc0hvcml6b250YWwiLCJjZWxscyIsInN0YXJ0Iiwic2l6ZSIsImxlbmd0aCIsImN1cnJlbnRDb2wiLCJjdXJyZW50Um93IiwicmVjZWl2ZUF0dGFjayIsImNlbGwiLCJoaXQiLCJzaW5rU2hpcCIsImdhbWVib2FyZCIsImlzU3VuayIsImZsYXQiLCJmaWx0ZXIiLCJjIiwibmFtZSIsImZvckVhY2giLCJkaXJlY3Rpb24iLCJuZXdDb2wiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJjaGFyQ29kZUF0IiwibmV3Um93IiwiTnVtYmVyIiwidG9TdHJpbmciLCJhbGxTdW5rIiwiaGl0Q291bnRlciIsImF0dGFjayIsInJhbmRvbUF0dGFjayIsInJhbmRvbUNvbCIsInJhbmRvbVJvdyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNlaWwiLCJyZXN1bHQiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwidWkiLCJ3cmFwcGVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYm9hcmRzIiwiY3JlYXRlRWxlbWVudCIsImlkIiwiYXBwZW5kIiwicmVuZGVyQ2VsbHMiLCJib2FyZCIsImNsYXNzTGlzdCIsImFkZCIsInNldEF0dHJpYnV0ZSIsImNyZWF0ZUNlbGwiLCJnZXRVc2VySW5wdXQiLCJjb25zb2xlIiwibG9nIiwidGFyZ2V0IiwiY29udGFpbnMiLCJnZXRBdHRyaWJ1dGUiLCJyZW5kZXJCb2FyZCIsImh1bWFuR2FtZWJvYXJkIiwiY29tcHV0ZXJHYW1lYm9hcmQiLCJyZWZyZXNoQm9hcmQiLCJib2FyZElkIiwiaW5uZXJIVE1MIiwiaGFuZGxlVXNlcklucHV0IiwidGhpcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ1c2VySW5wdXQiLCJhZGRFdmVudExpc3RlbmVyIiwib25jZSIsImh1bWFuIiwicGxheWVyIiwiY29tcHV0ZXIiLCJwb3B1bGF0ZUdhbWVib2FyZCIsImh1bWFuQ2FycmllciIsImh1bWFuQmF0dGxlc2hpcCIsImh1bWFuRGVzdHJveWVyIiwiaHVtYW5TdWJtYXJpbmUiLCJodW1hblBhdHJvbGJvYXQiLCJjb21wdXRlckNhcnJpZXIiLCJjb21wdXRlckJhdHRsZXNoaXAiLCJjb21wdXRlckRlc3Ryb3llciIsImNvbXB1dGVyU3VibWFyaW5lIiwiY29tcHV0ZXJQYXRyb2xib2F0IiwiaXNHYW1lT3ZlciIsInBsYXllclZzQ29tcHV0ZXIiLCJjb21wdXRlclZzQ29tcHV0ZXIiLCJpc1N0b3BwZWQiLCJnZXRHYW1lTW9kZSIsInNldFRpbWVvdXQiLCJyYW5kb21Db2wyIiwicmFuZG9tUm93MiIsInJhbmRvbUNvbDEiLCJyYW5kb21Sb3cxIiwicmVzdGFydCIsIm5ld0dhbWUiLCJkaXNhYmxlZCIsInRleHRDb250ZW50IiwicmVtb3ZlIl0sInNvdXJjZVJvb3QiOiIifQ==