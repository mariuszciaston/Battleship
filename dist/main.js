(()=>{"use strict";const t=()=>{const t=["A","B","C","D","E","F","G","H","I","J"],e=["1","2","3","4","5","6","7","8","9","10"],r=[],o=(o,n)=>{const a=t.indexOf(o),i=e.indexOf(n);return-1===a||-1===i?null:r[i][a]},n=(o,n,a,i)=>{const l=t.indexOf(o),s=e.indexOf(n);return-1===l||-1===s?null:(r[s][l].status=a,i&&(r[s][l].takenBy=i),r[s][l])};return(()=>{for(let o=0;o<10;o+=1){r[o]=[];for(let n=0;n<10;n+=1)r[o][n]={col:t[n],row:e[o],status:"empty",takenBy:void 0}}})(),{getCell:o,setCell:n,placeShip:(r,a,i,l)=>{const s="horizontal"===l,c=s?t:e,u=c.indexOf(s?a:i);if(u<0||u+r.size>c.length)return!1;for(let t=0;t<r.size;t+=1){const e=s?c[u+t]:a,l=s?i:c[u+t];if("empty"!==o(e,l).status)return!1;n(e,l,"taken",r)}return!0},receiveAttack:(t,e)=>{const r=o(t,e);return"taken"===r.status?(r.takenBy.hit(),n(t,e,"hit"),r.status):"empty"===r.status?(n(t,e,"miss"),r.status):null},sinkShip:(t,e,r)=>{const o=t.getCell(e,r);if(o&&o.takenBy&&o.takenBy.isSunk()){t.array.flat().filter((t=>t.takenBy&&t.takenBy.name===o.takenBy.name)).forEach((e=>{[{col:0,row:-1},{col:0,row:1},{col:-1,row:0},{col:1,row:0},{col:-1,row:-1},{col:-1,row:1},{col:1,row:-1},{col:1,row:1}].forEach((r=>{const o=String.fromCharCode(e.col.charCodeAt(0)+r.col),n=(Number(e.row)+r.row).toString();t.getCell(o,n)&&t.receiveAttack(o,n)}))}))}},allSunk:()=>{for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1)if("taken"===r[t][e].status&&!r[t][e].takenBy.isSunk())return!1;return!0},array:r}},e=t=>{let e,r=0;"Carrier"===t&&(e=5),"Battleship"===t&&(e=4),"Destroyer"===t&&(e=3),"Submarine"===t&&(e=3),"Patrol Boat"===t&&(e=2);return{name:t,size:e,hit:()=>{r+=1},isSunk:()=>r===e}},r=()=>({attack:(t,e,r)=>"hit"!==t.getCell(e,r).status&&"miss"!==t.getCell(e,r).status?t.receiveAttack(e,r):"already shot",randomAttack:t=>{const e=["A","B","C","D","E","F","G","H","I","J"];let r,o;do{r=e[Math.floor(Math.random()*e.length)],o=Math.ceil(10*Math.random()).toString()}while("hit"===t.getCell(r,o).status||"miss"===t.getCell(r,o).status);if("hit"!==t.getCell(r,o).status&&"miss"!==t.getCell(r,o).status){return{result:t.receiveAttack(r,o),col:r,row:o}}return{result:"already shot",col:r,row:o}}});var o=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function i(t){try{s(o.next(t))}catch(t){a(t)}}function l(t){try{s(o.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,l)}s((o=o.apply(t,e||[])).next())}))};const n=(()=>{const t=document.createElement("div");t.id="wrapper",document.body.append(t);const e=(t,e)=>{t.array.forEach((t=>{t.forEach((t=>{const r=(t=>{const e=document.createElement("div");return e.classList.add("cell"),e.classList.add(t.status),e.setAttribute("data-col",t.col),e.setAttribute("data-row",t.row),e})(t);e.append(r)}))}))},r=t=>{if(console.log(t.target),!t.target.classList.contains("hit")&&!t.target.classList.contains("miss")){return{col:t.target.getAttribute("data-col"),row:t.target.getAttribute("data-row")}}};return{renderBoard:r=>{const o=document.createElement("div");o.classList.add("board"),r===l?o.id="firstBoard":r===s&&(o.id="secondBoard"),e(r,o),t.append(o)},refreshBoard:t=>{const r=t===l?"firstBoard":"secondBoard",o=document.querySelector(`#${r}`);o.innerHTML="",e(t,o)},handleUserInput:function(){return o(this,void 0,void 0,(function*(){const t=document.querySelectorAll("#secondBoard .cell");let e;do{e=yield new Promise((e=>{t.forEach((t=>{t.classList.contains("hit")||t.classList.contains("miss")||t.addEventListener("click",(t=>{e(r(t))}),{once:!0})}))}))}while(!e);return{col:e.col.toString(),row:e.row.toString()}}))}}})(),a=n;var i=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function i(t){try{s(o.next(t))}catch(t){a(t)}}function l(t){try{s(o.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,l)}s((o=o.apply(t,e||[])).next())}))};const l=t(),s=t(),c=r(),u=r();(()=>{i(void 0,void 0,void 0,(function*(){for((()=>{const t=e("Carrier"),r=e("Battleship"),o=e("Destroyer"),n=e("Submarine"),a=e("Patrol Boat"),i=e("Carrier"),c=e("Battleship"),u=e("Destroyer"),d=e("Submarine"),h=e("Patrol Boat");l.placeShip(t,"A","1","horizontal"),l.placeShip(r,"A","3","horizontal"),l.placeShip(o,"A","5","horizontal"),l.placeShip(n,"A","7","horizontal"),l.placeShip(a,"A","9","horizontal"),s.placeShip(i,"A","1","vertical"),s.placeShip(c,"C","1","vertical"),s.placeShip(u,"E","1","vertical"),s.placeShip(d,"G","1","vertical"),s.placeShip(h,"I","1","vertical")})(),a.renderBoard(l),a.renderBoard(s);!1==(s.allSunk()?(console.log("All computer ships are sunk. Human player won!"),!0):!!l.allSunk()&&(console.log("All human ships are sunk. Computer player won!"),!0));){yield new Promise((t=>setTimeout(t,100)));const{col:t,row:e}=c.randomAttack(s);s.sinkShip(s,t,e),a.refreshBoard(s),yield new Promise((t=>setTimeout(t,100)));const{col:r,row:o}=u.randomAttack(l);l.sinkShip(l,r,o),a.refreshBoard(l)}console.log("Game Over")}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ckIsSUFBSTNCLFNBQVNDLEdBQVl5RCxXQUFXekQsRUFBUyxPQUNuRCxNQUFRNUQsSUFBS3NILEVBQVlySCxJQUFLc0gsR0FBZWhCLEVBQU16RCxhQUFhOEMsR0FDaEVBLEVBQWtCakUsU0FBU2lFLEVBQW1CMEIsRUFBWUMsR0FDMUQsRUFBRzFCLGFBQWFELFNBQ1YsSUFBSWpDLFNBQVNDLEdBQVl5RCxXQUFXekQsRUFBUyxPQUNuRCxNQUFRNUQsSUFBS3dILEVBQVl2SCxJQUFLd0gsR0FBZWhCLEVBQVMzRCxhQUFhNkMsR0FDbkVBLEVBQWVoRSxTQUFTZ0UsRUFBZ0I2QixFQUFZQyxHQUNwRCxFQUFHNUIsYUFBYUYsRUFDcEIsQ0FDQU4sUUFBUUMsSUFBSSxZQUNoQixHQUFFLEVDaEZGLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvZ2FtZWJvYXJkLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3VpLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9jb250cm9sbGVyLnRzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZ2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBjb2xzID0gWydBJywgJ0InLCAnQycsICdEJywgJ0UnLCAnRicsICdHJywgJ0gnLCAnSScsICdKJ107XG4gICAgY29uc3Qgcm93cyA9IFsnMScsICcyJywgJzMnLCAnNCcsICc1JywgJzYnLCAnNycsICc4JywgJzknLCAnMTAnXTtcbiAgICBjb25zdCBhcnJheSA9IFtdO1xuICAgIGNvbnN0IGdlbmVyYXRlQXJyYXkgPSAoKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkgKz0gMSkge1xuICAgICAgICAgICAgYXJyYXlbaV0gPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGFycmF5W2ldW2pdID0geyBjb2w6IGNvbHNbal0sIHJvdzogcm93c1tpXSwgc3RhdHVzOiAnZW1wdHknLCB0YWtlbkJ5OiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZ2V0Q2VsbCA9IChjb2wsIHJvdykgPT4ge1xuICAgICAgICBjb25zdCBjb2xJbmRleCA9IGNvbHMuaW5kZXhPZihjb2wpO1xuICAgICAgICBjb25zdCByb3dJbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuICAgICAgICBpZiAoY29sSW5kZXggPT09IC0xIHx8IHJvd0luZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF07XG4gICAgfTtcbiAgICBjb25zdCBzZXRDZWxsID0gKGNvbCwgcm93LCBuZXdTdGF0dXMsIG5ld1Rha2VuQnkpID0+IHtcbiAgICAgICAgY29uc3QgY29sSW5kZXggPSBjb2xzLmluZGV4T2YoY29sKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcbiAgICAgICAgaWYgKGNvbEluZGV4ID09PSAtMSB8fCByb3dJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF0uc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICBpZiAobmV3VGFrZW5CeSkge1xuICAgICAgICAgICAgYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XS50YWtlbkJ5ID0gbmV3VGFrZW5CeTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XTtcbiAgICB9O1xuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb2wsIHJvdywgb3JpZW50YXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgaXNIb3Jpem9udGFsID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcbiAgICAgICAgY29uc3QgY2VsbHMgPSBpc0hvcml6b250YWwgPyBjb2xzIDogcm93cztcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBjZWxscy5pbmRleE9mKGlzSG9yaXpvbnRhbCA/IGNvbCA6IHJvdyk7XG4gICAgICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgKyBzaGlwLnNpemUgPiBjZWxscy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuc2l6ZTsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sID0gaXNIb3Jpem9udGFsID8gY2VsbHNbc3RhcnQgKyBpXSA6IGNvbDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBpc0hvcml6b250YWwgPyByb3cgOiBjZWxsc1tzdGFydCArIGldO1xuICAgICAgICAgICAgaWYgKGdldENlbGwoY3VycmVudENvbCwgY3VycmVudFJvdykuc3RhdHVzICE9PSAnZW1wdHknKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0Q2VsbChjdXJyZW50Q29sLCBjdXJyZW50Um93LCAndGFrZW4nLCBzaGlwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29sLCByb3cpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdldENlbGwoY29sLCByb3cpO1xuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICd0YWtlbicpIHtcbiAgICAgICAgICAgIGNlbGwudGFrZW5CeS5oaXQoKTtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdoaXQnKTtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLnN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICdlbXB0eScpIHtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdtaXNzJyk7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5zdGF0dXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICBjb25zdCBzaW5rU2hpcCA9IChnYW1lYm9hcmQsIGNvbCwgcm93KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBnYW1lYm9hcmQuZ2V0Q2VsbChjb2wsIHJvdyk7XG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwudGFrZW5CeSAmJiBjZWxsLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXBDZWxscyA9IGdhbWVib2FyZC5hcnJheS5mbGF0KCkuZmlsdGVyKChjKSA9PiBjLnRha2VuQnkgJiYgYy50YWtlbkJ5Lm5hbWUgPT09IGNlbGwudGFrZW5CeS5uYW1lKTtcbiAgICAgICAgICAgIHNoaXBDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogLTEgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMCB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgY29sOiAtMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAxIH0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25zLmZvckVhY2goKGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2wgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNlbGwuY29sLmNoYXJDb2RlQXQoMCkgKyBkaXJlY3Rpb24uY29sKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Um93ID0gKE51bWJlcihjZWxsLnJvdykgKyBkaXJlY3Rpb24ucm93KS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwobmV3Q29sLCBuZXdSb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhuZXdDb2wsIG5ld1Jvdyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBhbGxTdW5rID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGlmIChhcnJheVtpXVtqXS5zdGF0dXMgPT09ICd0YWtlbicgJiYgIWFycmF5W2ldW2pdLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGdlbmVyYXRlQXJyYXkoKTtcbiAgICByZXR1cm4geyBnZXRDZWxsLCBzZXRDZWxsLCBwbGFjZVNoaXAsIHJlY2VpdmVBdHRhY2ssIHNpbmtTaGlwLCBhbGxTdW5rLCBhcnJheSB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZEZhY3Rvcnk7XG4iLCJjb25zdCBzaGlwRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gICAgbGV0IGhpdENvdW50ZXIgPSAwO1xuICAgIGxldCBzaXplO1xuICAgIGlmIChuYW1lID09PSAnQ2FycmllcicpIHtcbiAgICAgICAgc2l6ZSA9IDU7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnQmF0dGxlc2hpcCcpIHtcbiAgICAgICAgc2l6ZSA9IDQ7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnRGVzdHJveWVyJykge1xuICAgICAgICBzaXplID0gMztcbiAgICB9XG4gICAgaWYgKG5hbWUgPT09ICdTdWJtYXJpbmUnKSB7XG4gICAgICAgIHNpemUgPSAzO1xuICAgIH1cbiAgICBpZiAobmFtZSA9PT0gJ1BhdHJvbCBCb2F0Jykge1xuICAgICAgICBzaXplID0gMjtcbiAgICB9XG4gICAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgICAgICBoaXRDb3VudGVyICs9IDE7XG4gICAgfTtcbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgICAgIGlmIChoaXRDb3VudGVyID09PSBzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4geyBuYW1lLCBzaXplLCBoaXQsIGlzU3VuayB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IHNoaXBGYWN0b3J5O1xuIiwiY29uc3QgcGxheWVyRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBhdHRhY2sgPSAoZ2FtZWJvYXJkLCBjb2wsIHJvdykgPT4ge1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29sLCByb3cpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnYWxyZWFkeSBzaG90JztcbiAgICB9O1xuICAgIGNvbnN0IHJhbmRvbUF0dGFjayA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgY29scyA9IFsnQScsICdCJywgJ0MnLCAnRCcsICdFJywgJ0YnLCAnRycsICdIJywgJ0knLCAnSiddO1xuICAgICAgICBsZXQgcmFuZG9tQ29sO1xuICAgICAgICBsZXQgcmFuZG9tUm93O1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICByYW5kb21Db2wgPSBjb2xzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNvbHMubGVuZ3RoKV07XG4gICAgICAgICAgICByYW5kb21Sb3cgPSBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwKS50b1N0cmluZygpO1xuICAgICAgICB9IHdoaWxlIChnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnaGl0JyB8fCBnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnbWlzcycpO1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhyYW5kb21Db2wsIHJhbmRvbVJvdyk7XG4gICAgICAgICAgICByZXR1cm4geyByZXN1bHQsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogJ2FscmVhZHkgc2hvdCcsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgIH07XG4gICAgcmV0dXJuIHsgYXR0YWNrLCByYW5kb21BdHRhY2sgfTtcbn07XG5leHBvcnQgZGVmYXVsdCBwbGF5ZXJGYWN0b3J5O1xuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5pbXBvcnQgeyBodW1hbkdhbWVib2FyZCwgY29tcHV0ZXJHYW1lYm9hcmQgfSBmcm9tICcuL2NvbnRyb2xsZXInO1xuY29uc3QgdWkgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB3cmFwcGVyLmlkID0gJ3dyYXBwZXInO1xuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHdyYXBwZXIpO1xuICAgIGNvbnN0IGNyZWF0ZUNlbGwgPSAoY29sKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdjZWxsJyk7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChjb2wuc3RhdHVzKTtcbiAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29sJywgY29sLmNvbCk7XG4gICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLXJvdycsIGNvbC5yb3cpO1xuICAgICAgICByZXR1cm4gY2VsbDtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckNlbGxzID0gKGdhbWVib2FyZCwgYm9hcmQpID0+IHtcbiAgICAgICAgZ2FtZWJvYXJkLmFycmF5LmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgICAgICAgcm93LmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBjcmVhdGVDZWxsKGNvbCk7XG4gICAgICAgICAgICAgICAgYm9hcmQuYXBwZW5kKGNlbGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyQm9hcmQgPSAoZ2FtZWJvYXJkKSA9PiB7XG4gICAgICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGJvYXJkLmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XG4gICAgICAgIGlmIChnYW1lYm9hcmQgPT09IGh1bWFuR2FtZWJvYXJkKSB7XG4gICAgICAgICAgICBib2FyZC5pZCA9ICdmaXJzdEJvYXJkJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChnYW1lYm9hcmQgPT09IGNvbXB1dGVyR2FtZWJvYXJkKSB7XG4gICAgICAgICAgICBib2FyZC5pZCA9ICdzZWNvbmRCb2FyZCc7XG4gICAgICAgIH1cbiAgICAgICAgcmVuZGVyQ2VsbHMoZ2FtZWJvYXJkLCBib2FyZCk7XG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKGJvYXJkKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlZnJlc2hCb2FyZCA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgYm9hcmRJZCA9IGdhbWVib2FyZCA9PT0gaHVtYW5HYW1lYm9hcmQgPyAnZmlyc3RCb2FyZCcgOiAnc2Vjb25kQm9hcmQnO1xuICAgICAgICBjb25zdCBib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2JvYXJkSWR9YCk7XG4gICAgICAgIGJvYXJkLmlubmVySFRNTCA9ICcnO1xuICAgICAgICByZW5kZXJDZWxscyhnYW1lYm9hcmQsIGJvYXJkKTtcbiAgICB9O1xuICAgIGNvbnN0IGdldFVzZXJJbnB1dCA9IChlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpdCcpICYmICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21pc3MnKSkge1xuICAgICAgICAgICAgY29uc3QgY29sID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbCcpO1xuICAgICAgICAgICAgY29uc3Qgcm93ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvdycpO1xuICAgICAgICAgICAgcmV0dXJuIHsgY29sLCByb3cgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZnVuY3Rpb24gaGFuZGxlVXNlcklucHV0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjc2Vjb25kQm9hcmQgLmNlbGwnKTtcbiAgICAgICAgICAgIGxldCB1c2VySW5wdXQ7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgdXNlcklucHV0ID0geWllbGQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnaGl0JykgJiYgIWNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdtaXNzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShnZXRVc2VySW5wdXQoZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsgb25jZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IHdoaWxlICghdXNlcklucHV0KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbCA9IHVzZXJJbnB1dC5jb2wudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHVzZXJJbnB1dC5yb3cudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHJldHVybiB7IGNvbCwgcm93IH07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4geyByZW5kZXJCb2FyZCwgcmVmcmVzaEJvYXJkLCBoYW5kbGVVc2VySW5wdXQgfTtcbn0pKCk7XG5leHBvcnQgZGVmYXVsdCB1aTtcbiIsInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuaW1wb3J0IGdhbWVib2FyZEZhY3RvcnkgZnJvbSAnLi9nYW1lYm9hcmQnO1xuaW1wb3J0IHNoaXBGYWN0b3J5IGZyb20gJy4vc2hpcCc7XG5pbXBvcnQgcGxheWVyRmFjdG9yeSBmcm9tICcuL3BsYXllcic7XG5pbXBvcnQgdWkgZnJvbSAnLi91aSc7XG5jb25zdCBodW1hbkdhbWVib2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbmNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuY29uc3QgaHVtYW4gPSBwbGF5ZXJGYWN0b3J5KCk7XG5jb25zdCBjb21wdXRlciA9IHBsYXllckZhY3RvcnkoKTtcbmNvbnN0IHBvcHVsYXRlR2FtZWJvYXJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGh1bWFuQ2FycmllciA9IHNoaXBGYWN0b3J5KCdDYXJyaWVyJyk7XG4gICAgY29uc3QgaHVtYW5CYXR0bGVzaGlwID0gc2hpcEZhY3RvcnkoJ0JhdHRsZXNoaXAnKTtcbiAgICBjb25zdCBodW1hbkRlc3Ryb3llciA9IHNoaXBGYWN0b3J5KCdEZXN0cm95ZXInKTtcbiAgICBjb25zdCBodW1hblN1Ym1hcmluZSA9IHNoaXBGYWN0b3J5KCdTdWJtYXJpbmUnKTtcbiAgICBjb25zdCBodW1hblBhdHJvbGJvYXQgPSBzaGlwRmFjdG9yeSgnUGF0cm9sIEJvYXQnKTtcbiAgICBjb25zdCBjb21wdXRlckNhcnJpZXIgPSBzaGlwRmFjdG9yeSgnQ2FycmllcicpO1xuICAgIGNvbnN0IGNvbXB1dGVyQmF0dGxlc2hpcCA9IHNoaXBGYWN0b3J5KCdCYXR0bGVzaGlwJyk7XG4gICAgY29uc3QgY29tcHV0ZXJEZXN0cm95ZXIgPSBzaGlwRmFjdG9yeSgnRGVzdHJveWVyJyk7XG4gICAgY29uc3QgY29tcHV0ZXJTdWJtYXJpbmUgPSBzaGlwRmFjdG9yeSgnU3VibWFyaW5lJyk7XG4gICAgY29uc3QgY29tcHV0ZXJQYXRyb2xib2F0ID0gc2hpcEZhY3RvcnkoJ1BhdHJvbCBCb2F0Jyk7XG4gICAgaHVtYW5HYW1lYm9hcmQucGxhY2VTaGlwKGh1bWFuQ2FycmllciwgJ0EnLCAnMScsICdob3Jpem9udGFsJyk7XG4gICAgaHVtYW5HYW1lYm9hcmQucGxhY2VTaGlwKGh1bWFuQmF0dGxlc2hpcCwgJ0EnLCAnMycsICdob3Jpem9udGFsJyk7XG4gICAgaHVtYW5HYW1lYm9hcmQucGxhY2VTaGlwKGh1bWFuRGVzdHJveWVyLCAnQScsICc1JywgJ2hvcml6b250YWwnKTtcbiAgICBodW1hbkdhbWVib2FyZC5wbGFjZVNoaXAoaHVtYW5TdWJtYXJpbmUsICdBJywgJzcnLCAnaG9yaXpvbnRhbCcpO1xuICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hblBhdHJvbGJvYXQsICdBJywgJzknLCAnaG9yaXpvbnRhbCcpO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlckNhcnJpZXIsICdBJywgJzEnLCAndmVydGljYWwnKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoY29tcHV0ZXJCYXR0bGVzaGlwLCAnQycsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKGNvbXB1dGVyRGVzdHJveWVyLCAnRScsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKGNvbXB1dGVyU3VibWFyaW5lLCAnRycsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKGNvbXB1dGVyUGF0cm9sYm9hdCwgJ0knLCAnMScsICd2ZXJ0aWNhbCcpO1xufTtcbmNvbnN0IGlzR2FtZU92ZXIgPSAoKSA9PiB7XG4gICAgaWYgKGNvbXB1dGVyR2FtZWJvYXJkLmFsbFN1bmsoKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnQWxsIGNvbXB1dGVyIHNoaXBzIGFyZSBzdW5rLiBIdW1hbiBwbGF5ZXIgd29uIScpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGh1bWFuR2FtZWJvYXJkLmFsbFN1bmsoKSkge1xuICAgICAgICBjb25zb2xlLmxvZygnQWxsIGh1bWFuIHNoaXBzIGFyZSBzdW5rLiBDb21wdXRlciBwbGF5ZXIgd29uIScpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcbi8vIC8vIHBsYXllciB2cyBjb21wdXRlclxuLy8gY29uc3Qgc3RhcnQgPSBhc3luYyAoKSA9PiB7XG4vLyBcdHBvcHVsYXRlR2FtZWJvYXJkKCk7XG4vLyBcdHVpLnJlbmRlckJvYXJkKGh1bWFuR2FtZWJvYXJkKTtcbi8vIFx0dWkucmVuZGVyQm9hcmQoY29tcHV0ZXJHYW1lYm9hcmQpO1xuLy8gXHR3aGlsZSAoaXNHYW1lT3ZlcigpID09PSBmYWxzZSkge1xuLy8gXHRcdGNvbnN0IHsgY29sLCByb3cgfSA9IGF3YWl0IHVpLmhhbmRsZVVzZXJJbnB1dCgpO1xuLy8gXHRcdGh1bWFuLmF0dGFjayhjb21wdXRlckdhbWVib2FyZCwgY29sLCByb3cpO1xuLy8gXHRcdGNvbXB1dGVyR2FtZWJvYXJkLnNpbmtTaGlwKGNvbXB1dGVyR2FtZWJvYXJkLCBjb2wsIHJvdyk7XG4vLyBcdFx0dWkucmVmcmVzaEJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbi8vIFx0XHRhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbi8vIFx0XHRjb25zdCB7IGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9ID0gY29tcHV0ZXIucmFuZG9tQXR0YWNrKGh1bWFuR2FtZWJvYXJkKTtcbi8vIFx0XHRodW1hbkdhbWVib2FyZC5zaW5rU2hpcChodW1hbkdhbWVib2FyZCwgcmFuZG9tQ29sLCByYW5kb21Sb3cpO1xuLy8gXHRcdHVpLnJlZnJlc2hCb2FyZChodW1hbkdhbWVib2FyZCk7XG4vLyBcdH1cbi8vIFx0Y29uc29sZS5sb2coJ0dhbWUgT3ZlcicpO1xuLy8gfTtcbi8vIGNvbXB1dGVyIHZzIGNvbXB1dGVyXG5jb25zdCBzdGFydCA9ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIHBvcHVsYXRlR2FtZWJvYXJkKCk7XG4gICAgdWkucmVuZGVyQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgIHVpLnJlbmRlckJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICB3aGlsZSAoaXNHYW1lT3ZlcigpID09PSBmYWxzZSkge1xuICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgY29uc3QgeyBjb2w6IHJhbmRvbUNvbDEsIHJvdzogcmFuZG9tUm93MSB9ID0gaHVtYW4ucmFuZG9tQXR0YWNrKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICAgICAgY29tcHV0ZXJHYW1lYm9hcmQuc2lua1NoaXAoY29tcHV0ZXJHYW1lYm9hcmQsIHJhbmRvbUNvbDEsIHJhbmRvbVJvdzEpO1xuICAgICAgICB1aS5yZWZyZXNoQm9hcmQoY29tcHV0ZXJHYW1lYm9hcmQpO1xuICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgY29uc3QgeyBjb2w6IHJhbmRvbUNvbDIsIHJvdzogcmFuZG9tUm93MiB9ID0gY29tcHV0ZXIucmFuZG9tQXR0YWNrKGh1bWFuR2FtZWJvYXJkKTtcbiAgICAgICAgaHVtYW5HYW1lYm9hcmQuc2lua1NoaXAoaHVtYW5HYW1lYm9hcmQsIHJhbmRvbUNvbDIsIHJhbmRvbVJvdzIpO1xuICAgICAgICB1aS5yZWZyZXNoQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZygnR2FtZSBPdmVyJyk7XG59KTtcbmV4cG9ydCB7IGh1bWFuR2FtZWJvYXJkLCBjb21wdXRlckdhbWVib2FyZCB9O1xuZXhwb3J0IGRlZmF1bHQgc3RhcnQ7XG4iLCJpbXBvcnQgJ25vcm1hbGl6ZS5jc3MnO1xuaW1wb3J0ICcuL3N0eWxlL3N0eWxlLmNzcyc7XG5pbXBvcnQgc3RhcnQgZnJvbSAnLi9tb2R1bGVzL2NvbnRyb2xsZXInO1xuc3RhcnQoKTtcbiJdLCJuYW1lcyI6WyJjb2xzIiwicm93cyIsImFycmF5IiwiZ2V0Q2VsbCIsImNvbCIsInJvdyIsImNvbEluZGV4IiwiaW5kZXhPZiIsInJvd0luZGV4Iiwic2V0Q2VsbCIsIm5ld1N0YXR1cyIsIm5ld1Rha2VuQnkiLCJzdGF0dXMiLCJ0YWtlbkJ5IiwiaSIsImoiLCJ1bmRlZmluZWQiLCJnZW5lcmF0ZUFycmF5IiwicGxhY2VTaGlwIiwic2hpcCIsIm9yaWVudGF0aW9uIiwiaXNIb3Jpem9udGFsIiwiY2VsbHMiLCJzdGFydCIsInNpemUiLCJsZW5ndGgiLCJjdXJyZW50Q29sIiwiY3VycmVudFJvdyIsInJlY2VpdmVBdHRhY2siLCJjZWxsIiwiaGl0Iiwic2lua1NoaXAiLCJnYW1lYm9hcmQiLCJpc1N1bmsiLCJmbGF0IiwiZmlsdGVyIiwiYyIsIm5hbWUiLCJmb3JFYWNoIiwiZGlyZWN0aW9uIiwibmV3Q29sIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiY2hhckNvZGVBdCIsIm5ld1JvdyIsIk51bWJlciIsInRvU3RyaW5nIiwiYWxsU3VuayIsImhpdENvdW50ZXIiLCJhdHRhY2siLCJyYW5kb21BdHRhY2siLCJyYW5kb21Db2wiLCJyYW5kb21Sb3ciLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjZWlsIiwicmVzdWx0IiwiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInVpIiwid3JhcHBlciIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlkIiwiYm9keSIsImFwcGVuZCIsInJlbmRlckNlbGxzIiwiYm9hcmQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJjcmVhdGVDZWxsIiwiZ2V0VXNlcklucHV0IiwiY29uc29sZSIsImxvZyIsInRhcmdldCIsImNvbnRhaW5zIiwiZ2V0QXR0cmlidXRlIiwicmVuZGVyQm9hcmQiLCJodW1hbkdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwicmVmcmVzaEJvYXJkIiwiYm9hcmRJZCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJoYW5kbGVVc2VySW5wdXQiLCJ0aGlzIiwicXVlcnlTZWxlY3RvckFsbCIsInVzZXJJbnB1dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbmNlIiwiaHVtYW4iLCJwbGF5ZXIiLCJjb21wdXRlciIsImh1bWFuQ2FycmllciIsImh1bWFuQmF0dGxlc2hpcCIsImh1bWFuRGVzdHJveWVyIiwiaHVtYW5TdWJtYXJpbmUiLCJodW1hblBhdHJvbGJvYXQiLCJjb21wdXRlckNhcnJpZXIiLCJjb21wdXRlckJhdHRsZXNoaXAiLCJjb21wdXRlckRlc3Ryb3llciIsImNvbXB1dGVyU3VibWFyaW5lIiwiY29tcHV0ZXJQYXRyb2xib2F0IiwicG9wdWxhdGVHYW1lYm9hcmQiLCJzZXRUaW1lb3V0IiwicmFuZG9tQ29sMSIsInJhbmRvbVJvdzEiLCJyYW5kb21Db2wyIiwicmFuZG9tUm93MiJdLCJzb3VyY2VSb290IjoiIn0=