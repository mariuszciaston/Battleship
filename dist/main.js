(()=>{"use strict";const t=()=>{const t=["A","B","C","D","E","F","G","H","I","J"],e=["1","2","3","4","5","6","7","8","9","10"],r=[],o=(o,n)=>{const a=t.indexOf(o),s=e.indexOf(n);return-1===a||-1===s?null:r[s][a]},n=(o,n,a,s)=>{const c=t.indexOf(o),i=e.indexOf(n);return-1===c||-1===i?null:(r[i][c].status=a,s&&(r[i][c].takenBy=s),r[i][c])};return(()=>{for(let o=0;o<10;o+=1){r[o]=[];for(let n=0;n<10;n+=1)r[o][n]={col:t[n],row:e[o],status:"empty",takenBy:void 0}}})(),{clearBoard:()=>{for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1)r[t][e].status="empty",r[t][e].takenBy=void 0},getCell:o,setCell:n,placeShip:(r,a,s,c)=>{const i="horizontal"===c,l=i?t:e,d=l.indexOf(i?a:s);if(d<0||d+r.size>l.length)return!1;for(let t=0;t<r.size;t+=1){const e=i?l[d+t]:a,c=i?s:l[d+t];if("empty"!==o(e,c).status)return!1;n(e,c,"taken",r)}return!0},receiveAttack:(t,e)=>{const r=o(t,e);return"taken"===r.status?(r.takenBy.hit(),n(t,e,"hit"),r.status):"empty"===r.status?(n(t,e,"miss"),r.status):null},sinkShip:(t,e,r)=>{const o=t.getCell(e,r);if(o&&o.takenBy&&o.takenBy.isSunk()){t.array.flat().filter((t=>t.takenBy&&t.takenBy.name===o.takenBy.name)).forEach((e=>{[{col:0,row:-1},{col:0,row:1},{col:-1,row:0},{col:1,row:0},{col:-1,row:-1},{col:-1,row:1},{col:1,row:-1},{col:1,row:1}].forEach((r=>{const o=String.fromCharCode(e.col.charCodeAt(0)+r.col),n=(Number(e.row)+r.row).toString();t.getCell(o,n)&&t.receiveAttack(o,n)}))}))}},allSunk:()=>{for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1)if("taken"===r[t][e].status&&!r[t][e].takenBy.isSunk())return!1;return!0},array:r}},e=t=>{let e,r=0;"Carrier"===t&&(e=5),"Battleship"===t&&(e=4),"Destroyer"===t&&(e=3),"Submarine"===t&&(e=3),"Patrol Boat"===t&&(e=2);return{name:t,size:e,hit:()=>{r+=1},isSunk:()=>r===e}},r=()=>({attack:(t,e,r)=>"hit"!==t.getCell(e,r).status&&"miss"!==t.getCell(e,r).status?t.receiveAttack(e,r):"already shot",randomAttack:t=>{const e=["A","B","C","D","E","F","G","H","I","J"];let r,o;do{r=e[Math.floor(Math.random()*e.length)],o=Math.ceil(10*Math.random()).toString()}while("hit"===t.getCell(r,o).status||"miss"===t.getCell(r,o).status);if("hit"!==t.getCell(r,o).status&&"miss"!==t.getCell(r,o).status){return{result:t.receiveAttack(r,o),col:r,row:o}}return{result:"already shot",col:r,row:o}}});var o=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function s(t){try{i(o.next(t))}catch(t){a(t)}}function c(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};const n=(()=>{const t=document.querySelector("#wrapper"),e=document.createElement("div");e.id="boards",t.prepend(e);const r=document.querySelector("#playerVsComputer"),n=document.querySelector("#computerVsComputer"),a=document.querySelector("#newGame"),s=(t,e)=>{t.array.forEach((t=>{t.forEach((t=>{const r=(t=>{const e=document.createElement("div");return e.classList.add("cell"),e.classList.add(t.status),e.setAttribute("data-col",t.col),e.setAttribute("data-row",t.row),e})(t);e.append(r)}))}))},i=t=>{if(!t.target.classList.contains("hit")&&!t.target.classList.contains("miss")){return{col:t.target.getAttribute("data-col"),row:t.target.getAttribute("data-row")}}};const l=(t,e)=>{e.classList.remove("selected"),t.classList.contains("selected")||(t.classList.add("selected"),c.restart())};return r.addEventListener("click",(()=>l(r,n))),n.addEventListener("click",(()=>l(n,r))),a.addEventListener("click",(()=>o(void 0,void 0,void 0,(function*(){a.disabled=!0,a.textContent="Restarting",yield c.newGame(),a.textContent="New Game",a.disabled=!1})))),{renderBoard:t=>{const r=document.createElement("div");r.classList.add("board"),t===c.humanGameboard?r.id="firstBoard":t===c.computerGameboard&&(r.id="secondBoard"),s(t,r),e.append(r)},refreshBoard:t=>{const e=t===c.humanGameboard?"firstBoard":"secondBoard",r=document.querySelector(`#${e}`);r.innerHTML="",s(t,r)},handleUserInput:function(){return o(this,void 0,void 0,(function*(){const t=document.querySelectorAll("#secondBoard .cell");let e;do{e=yield new Promise((e=>{t.forEach((t=>{t.classList.contains("hit")||t.classList.contains("miss")||t.addEventListener("click",(t=>{e(i(t))}),{once:!0})}))}))}while(!e);return{col:e.col.toString(),row:e.row.toString()}}))},pVcBtn:r,cVcBtn:n}})(),a=n;var s=function(t,e,r,o){return new(r||(r=Promise))((function(n,a){function s(t){try{i(o.next(t))}catch(t){a(t)}}function c(t){try{i(o.throw(t))}catch(t){a(t)}}function i(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,c)}i((o=o.apply(t,e||[])).next())}))};const c=(()=>{const o=t(),n=t(),c=r(),i=r();let l=!1;const d=()=>{const t=e("Carrier"),r=e("Battleship"),a=e("Destroyer"),s=e("Submarine"),c=e("Patrol Boat"),i=e("Carrier"),l=e("Battleship"),d=e("Destroyer"),u=e("Submarine"),h=e("Patrol Boat");o.placeShip(t,"A","1","horizontal"),o.placeShip(r,"A","3","horizontal"),o.placeShip(a,"A","5","horizontal"),o.placeShip(s,"A","7","horizontal"),o.placeShip(c,"A","9","horizontal"),n.placeShip(i,"A","1","vertical"),n.placeShip(l,"C","1","vertical"),n.placeShip(d,"E","1","vertical"),n.placeShip(u,"G","1","vertical"),n.placeShip(h,"I","1","vertical")},u=()=>n.allSunk()?(console.log("All computer ships are sunk. Human player won!"),!0):!!o.allSunk()&&(console.log("All human ships are sunk. Computer player won!"),!0),h=()=>a.pVcBtn.classList.contains("selected")?s(void 0,void 0,void 0,(function*(){for(;!u()&&!l;){const{col:t,row:e}=yield a.handleUserInput();if(c.attack(n,t,e),n.sinkShip(n,t,e),a.refreshBoard(n),yield new Promise((t=>setTimeout(t,1e3))),!a.pVcBtn.classList.contains("selected")||l)break;const{col:r,row:s}=i.randomAttack(o);o.sinkShip(o,r,s),a.refreshBoard(o)}l=!1})):a.cVcBtn.classList.contains("selected")?s(void 0,void 0,void 0,(function*(){for(;!u()&&!l&&(yield new Promise((t=>setTimeout(t,500))),a.cVcBtn.classList.contains("selected")&&!l);){const{col:t,row:e}=i.randomAttack(o);if(o.sinkShip(o,t,e),a.refreshBoard(o),yield new Promise((t=>setTimeout(t,500))),!a.cVcBtn.classList.contains("selected")||l)break;const{col:r,row:s}=c.randomAttack(n);n.sinkShip(n,r,s),a.refreshBoard(n)}l=!1})):void 0,m=()=>{o.clearBoard(),n.clearBoard(),d(),a.refreshBoard(o),a.refreshBoard(n),h()};return{start:()=>{d(),a.renderBoard(o),a.renderBoard(n),h()},humanGameboard:o,computerGameboard:n,newGame:()=>s(void 0,void 0,void 0,(function*(){l=!0,yield new Promise((t=>setTimeout(t,1e3))),l=!1,m()})),restart:m}})();c.start()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eEUsRUFBUyxPQUNuRHdELEdBQVksRUFDWm5CLEdBQ0osSUFDNERBLFVBQy9ELEVBdkdrQixHQ1ZuQixFQUFXOUUsTyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lYm9hcmQudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3NoaXAudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3BsYXllci50cyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvdWkudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2NvbnRyb2xsZXIudHMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvbHMgPSBbJ0EnLCAnQicsICdDJywgJ0QnLCAnRScsICdGJywgJ0cnLCAnSCcsICdJJywgJ0onXTtcbiAgICBjb25zdCByb3dzID0gWycxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsICcxMCddO1xuICAgIGNvbnN0IGFycmF5ID0gW107XG4gICAgY29uc3QgZ2VuZXJhdGVBcnJheSA9ICgpID0+IHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSArPSAxKSB7XG4gICAgICAgICAgICBhcnJheVtpXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxMDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgYXJyYXlbaV1bal0gPSB7IGNvbDogY29sc1tqXSwgcm93OiByb3dzW2ldLCBzdGF0dXM6ICdlbXB0eScsIHRha2VuQnk6IHVuZGVmaW5lZCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBjbGVhckJvYXJkID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGFycmF5W2ldW2pdLnN0YXR1cyA9ICdlbXB0eSc7XG4gICAgICAgICAgICAgICAgYXJyYXlbaV1bal0udGFrZW5CeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZ2V0Q2VsbCA9IChjb2wsIHJvdykgPT4ge1xuICAgICAgICBjb25zdCBjb2xJbmRleCA9IGNvbHMuaW5kZXhPZihjb2wpO1xuICAgICAgICBjb25zdCByb3dJbmRleCA9IHJvd3MuaW5kZXhPZihyb3cpO1xuICAgICAgICBpZiAoY29sSW5kZXggPT09IC0xIHx8IHJvd0luZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF07XG4gICAgfTtcbiAgICBjb25zdCBzZXRDZWxsID0gKGNvbCwgcm93LCBuZXdTdGF0dXMsIG5ld1Rha2VuQnkpID0+IHtcbiAgICAgICAgY29uc3QgY29sSW5kZXggPSBjb2xzLmluZGV4T2YoY29sKTtcbiAgICAgICAgY29uc3Qgcm93SW5kZXggPSByb3dzLmluZGV4T2Yocm93KTtcbiAgICAgICAgaWYgKGNvbEluZGV4ID09PSAtMSB8fCByb3dJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGFycmF5W3Jvd0luZGV4XVtjb2xJbmRleF0uc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICBpZiAobmV3VGFrZW5CeSkge1xuICAgICAgICAgICAgYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XS50YWtlbkJ5ID0gbmV3VGFrZW5CeTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXlbcm93SW5kZXhdW2NvbEluZGV4XTtcbiAgICB9O1xuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb2wsIHJvdywgb3JpZW50YXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgaXNIb3Jpem9udGFsID0gb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJztcbiAgICAgICAgY29uc3QgY2VsbHMgPSBpc0hvcml6b250YWwgPyBjb2xzIDogcm93cztcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBjZWxscy5pbmRleE9mKGlzSG9yaXpvbnRhbCA/IGNvbCA6IHJvdyk7XG4gICAgICAgIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgKyBzaGlwLnNpemUgPiBjZWxscy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuc2l6ZTsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sID0gaXNIb3Jpem9udGFsID8gY2VsbHNbc3RhcnQgKyBpXSA6IGNvbDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBpc0hvcml6b250YWwgPyByb3cgOiBjZWxsc1tzdGFydCArIGldO1xuICAgICAgICAgICAgaWYgKGdldENlbGwoY3VycmVudENvbCwgY3VycmVudFJvdykuc3RhdHVzICE9PSAnZW1wdHknKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0Q2VsbChjdXJyZW50Q29sLCBjdXJyZW50Um93LCAndGFrZW4nLCBzaGlwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29sLCByb3cpID0+IHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdldENlbGwoY29sLCByb3cpO1xuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICd0YWtlbicpIHtcbiAgICAgICAgICAgIGNlbGwudGFrZW5CeS5oaXQoKTtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdoaXQnKTtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLnN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbC5zdGF0dXMgPT09ICdlbXB0eScpIHtcbiAgICAgICAgICAgIHNldENlbGwoY29sLCByb3csICdtaXNzJyk7XG4gICAgICAgICAgICByZXR1cm4gY2VsbC5zdGF0dXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICBjb25zdCBzaW5rU2hpcCA9IChnYW1lYm9hcmQsIGNvbCwgcm93KSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBnYW1lYm9hcmQuZ2V0Q2VsbChjb2wsIHJvdyk7XG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwudGFrZW5CeSAmJiBjZWxsLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXBDZWxscyA9IGdhbWVib2FyZC5hcnJheS5mbGF0KCkuZmlsdGVyKChjKSA9PiBjLnRha2VuQnkgJiYgYy50YWtlbkJ5Lm5hbWUgPT09IGNlbGwudGFrZW5CeS5uYW1lKTtcbiAgICAgICAgICAgIHNoaXBDZWxscy5mb3JFYWNoKChjZWxsKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogLTEgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBjb2w6IDAsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMCB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgY29sOiAtMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogLTEsIHJvdzogMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAtMSB9LFxuICAgICAgICAgICAgICAgICAgICB7IGNvbDogMSwgcm93OiAxIH0sXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25zLmZvckVhY2goKGRpcmVjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb2wgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNlbGwuY29sLmNoYXJDb2RlQXQoMCkgKyBkaXJlY3Rpb24uY29sKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Um93ID0gKE51bWJlcihjZWxsLnJvdykgKyBkaXJlY3Rpb24ucm93KS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwobmV3Q29sLCBuZXdSb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhuZXdDb2wsIG5ld1Jvdyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBhbGxTdW5rID0gKCkgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGogKz0gMSkge1xuICAgICAgICAgICAgICAgIGlmIChhcnJheVtpXVtqXS5zdGF0dXMgPT09ICd0YWtlbicgJiYgIWFycmF5W2ldW2pdLnRha2VuQnkuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIGdlbmVyYXRlQXJyYXkoKTtcbiAgICByZXR1cm4geyBjbGVhckJvYXJkLCBnZXRDZWxsLCBzZXRDZWxsLCBwbGFjZVNoaXAsIHJlY2VpdmVBdHRhY2ssIHNpbmtTaGlwLCBhbGxTdW5rLCBhcnJheSB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IGdhbWVib2FyZEZhY3Rvcnk7XG4iLCJjb25zdCBzaGlwRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gICAgbGV0IGhpdENvdW50ZXIgPSAwO1xuICAgIGxldCBzaXplO1xuICAgIGlmIChuYW1lID09PSAnQ2FycmllcicpIHtcbiAgICAgICAgc2l6ZSA9IDU7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnQmF0dGxlc2hpcCcpIHtcbiAgICAgICAgc2l6ZSA9IDQ7XG4gICAgfVxuICAgIGlmIChuYW1lID09PSAnRGVzdHJveWVyJykge1xuICAgICAgICBzaXplID0gMztcbiAgICB9XG4gICAgaWYgKG5hbWUgPT09ICdTdWJtYXJpbmUnKSB7XG4gICAgICAgIHNpemUgPSAzO1xuICAgIH1cbiAgICBpZiAobmFtZSA9PT0gJ1BhdHJvbCBCb2F0Jykge1xuICAgICAgICBzaXplID0gMjtcbiAgICB9XG4gICAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgICAgICBoaXRDb3VudGVyICs9IDE7XG4gICAgfTtcbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgICAgIGlmIChoaXRDb3VudGVyID09PSBzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4geyBuYW1lLCBzaXplLCBoaXQsIGlzU3VuayB9O1xufTtcbmV4cG9ydCBkZWZhdWx0IHNoaXBGYWN0b3J5O1xuIiwiY29uc3QgcGxheWVyRmFjdG9yeSA9ICgpID0+IHtcbiAgICBjb25zdCBhdHRhY2sgPSAoZ2FtZWJvYXJkLCBjb2wsIHJvdykgPT4ge1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwoY29sLCByb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29sLCByb3cpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnYWxyZWFkeSBzaG90JztcbiAgICB9O1xuICAgIGNvbnN0IHJhbmRvbUF0dGFjayA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgY29scyA9IFsnQScsICdCJywgJ0MnLCAnRCcsICdFJywgJ0YnLCAnRycsICdIJywgJ0knLCAnSiddO1xuICAgICAgICBsZXQgcmFuZG9tQ29sO1xuICAgICAgICBsZXQgcmFuZG9tUm93O1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICByYW5kb21Db2wgPSBjb2xzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNvbHMubGVuZ3RoKV07XG4gICAgICAgICAgICByYW5kb21Sb3cgPSBNYXRoLmNlaWwoTWF0aC5yYW5kb20oKSAqIDEwKS50b1N0cmluZygpO1xuICAgICAgICB9IHdoaWxlIChnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnaGl0JyB8fCBnYW1lYm9hcmQuZ2V0Q2VsbChyYW5kb21Db2wsIHJhbmRvbVJvdykuc3RhdHVzID09PSAnbWlzcycpO1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ2hpdCcgJiYgZ2FtZWJvYXJkLmdldENlbGwocmFuZG9tQ29sLCByYW5kb21Sb3cpLnN0YXR1cyAhPT0gJ21pc3MnKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhyYW5kb21Db2wsIHJhbmRvbVJvdyk7XG4gICAgICAgICAgICByZXR1cm4geyByZXN1bHQsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJlc3VsdDogJ2FscmVhZHkgc2hvdCcsIGNvbDogcmFuZG9tQ29sLCByb3c6IHJhbmRvbVJvdyB9O1xuICAgIH07XG4gICAgcmV0dXJuIHsgYXR0YWNrLCByYW5kb21BdHRhY2sgfTtcbn07XG5leHBvcnQgZGVmYXVsdCBwbGF5ZXJGYWN0b3J5O1xuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL2NvbnRyb2xsZXInO1xuY29uc3QgdWkgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3JhcHBlcicpO1xuICAgIGNvbnN0IGJvYXJkcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGJvYXJkcy5pZCA9ICdib2FyZHMnO1xuICAgIHdyYXBwZXIucHJlcGVuZChib2FyZHMpO1xuICAgIGNvbnN0IHBWY0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF5ZXJWc0NvbXB1dGVyJyk7XG4gICAgY29uc3QgY1ZjQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvbXB1dGVyVnNDb21wdXRlcicpO1xuICAgIGNvbnN0IG5ld0dhbWVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbmV3R2FtZScpO1xuICAgIGNvbnN0IGNyZWF0ZUNlbGwgPSAoY29sKSA9PiB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdjZWxsJyk7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChjb2wuc3RhdHVzKTtcbiAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29sJywgY29sLmNvbCk7XG4gICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLXJvdycsIGNvbC5yb3cpO1xuICAgICAgICByZXR1cm4gY2VsbDtcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlckNlbGxzID0gKGdhbWVib2FyZCwgYm9hcmQpID0+IHtcbiAgICAgICAgZ2FtZWJvYXJkLmFycmF5LmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgICAgICAgcm93LmZvckVhY2goKGNvbCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBjcmVhdGVDZWxsKGNvbCk7XG4gICAgICAgICAgICAgICAgYm9hcmQuYXBwZW5kKGNlbGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyQm9hcmQgPSAoZ2FtZWJvYXJkKSA9PiB7XG4gICAgICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGJvYXJkLmNsYXNzTGlzdC5hZGQoJ2JvYXJkJyk7XG4gICAgICAgIGlmIChnYW1lYm9hcmQgPT09IGNvbnRyb2xsZXIuaHVtYW5HYW1lYm9hcmQpIHtcbiAgICAgICAgICAgIGJvYXJkLmlkID0gJ2ZpcnN0Qm9hcmQnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdhbWVib2FyZCA9PT0gY29udHJvbGxlci5jb21wdXRlckdhbWVib2FyZCkge1xuICAgICAgICAgICAgYm9hcmQuaWQgPSAnc2Vjb25kQm9hcmQnO1xuICAgICAgICB9XG4gICAgICAgIHJlbmRlckNlbGxzKGdhbWVib2FyZCwgYm9hcmQpO1xuICAgICAgICBib2FyZHMuYXBwZW5kKGJvYXJkKTtcbiAgICB9O1xuICAgIGNvbnN0IHJlZnJlc2hCb2FyZCA9IChnYW1lYm9hcmQpID0+IHtcbiAgICAgICAgY29uc3QgYm9hcmRJZCA9IGdhbWVib2FyZCA9PT0gY29udHJvbGxlci5odW1hbkdhbWVib2FyZCA/ICdmaXJzdEJvYXJkJyA6ICdzZWNvbmRCb2FyZCc7XG4gICAgICAgIGNvbnN0IGJvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Ym9hcmRJZH1gKTtcbiAgICAgICAgYm9hcmQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIHJlbmRlckNlbGxzKGdhbWVib2FyZCwgYm9hcmQpO1xuICAgIH07XG4gICAgY29uc3QgZ2V0VXNlcklucHV0ID0gKGUpID0+IHtcbiAgICAgICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpdCcpICYmICFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21pc3MnKSkge1xuICAgICAgICAgICAgY29uc3QgY29sID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbCcpO1xuICAgICAgICAgICAgY29uc3Qgcm93ID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvdycpO1xuICAgICAgICAgICAgcmV0dXJuIHsgY29sLCByb3cgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZnVuY3Rpb24gaGFuZGxlVXNlcklucHV0KCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjc2Vjb25kQm9hcmQgLmNlbGwnKTtcbiAgICAgICAgICAgIGxldCB1c2VySW5wdXQ7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgdXNlcklucHV0ID0geWllbGQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnaGl0JykgJiYgIWNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdtaXNzJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShnZXRVc2VySW5wdXQoZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsgb25jZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IHdoaWxlICghdXNlcklucHV0KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbCA9IHVzZXJJbnB1dC5jb2wudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IHVzZXJJbnB1dC5yb3cudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHJldHVybiB7IGNvbCwgcm93IH07XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBoYW5kbGVOZXdHYW1lID0gKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIG5ld0dhbWVCdG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBuZXdHYW1lQnRuLnRleHRDb250ZW50ID0gJ1Jlc3RhcnRpbmcnO1xuICAgICAgICB5aWVsZCBjb250cm9sbGVyLm5ld0dhbWUoKTtcbiAgICAgICAgbmV3R2FtZUJ0bi50ZXh0Q29udGVudCA9ICdOZXcgR2FtZSc7XG4gICAgICAgIG5ld0dhbWVCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBjb25zdCBoYW5kbGVHYW1lTW9kZSA9IChzZWxlY3RlZEVsZW1lbnQsIGRlc2VsZWN0ZWRFbGVtZW50KSA9PiB7XG4gICAgICAgIGRlc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7XG4gICAgICAgIGlmICghc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSkge1xuICAgICAgICAgICAgc2VsZWN0ZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICBjb250cm9sbGVyLnJlc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcFZjQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gaGFuZGxlR2FtZU1vZGUocFZjQnRuLCBjVmNCdG4pKTtcbiAgICBjVmNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVHYW1lTW9kZShjVmNCdG4sIHBWY0J0bikpO1xuICAgIG5ld0dhbWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVOZXdHYW1lKTtcbiAgICByZXR1cm4geyByZW5kZXJCb2FyZCwgcmVmcmVzaEJvYXJkLCBoYW5kbGVVc2VySW5wdXQsIHBWY0J0biwgY1ZjQnRuIH07XG59KSgpO1xuZXhwb3J0IGRlZmF1bHQgdWk7XG4iLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCBnYW1lYm9hcmRGYWN0b3J5IGZyb20gJy4vZ2FtZWJvYXJkJztcbmltcG9ydCBzaGlwRmFjdG9yeSBmcm9tICcuL3NoaXAnO1xuaW1wb3J0IHBsYXllckZhY3RvcnkgZnJvbSAnLi9wbGF5ZXInO1xuaW1wb3J0IHVpIGZyb20gJy4vdWknO1xuY29uc3QgY29udHJvbGxlciA9ICgoKSA9PiB7XG4gICAgY29uc3QgaHVtYW5HYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gICAgY29uc3QgY29tcHV0ZXJHYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gICAgY29uc3QgaHVtYW4gPSBwbGF5ZXJGYWN0b3J5KCk7XG4gICAgY29uc3QgY29tcHV0ZXIgPSBwbGF5ZXJGYWN0b3J5KCk7XG4gICAgbGV0IGlzU3RvcHBlZCA9IGZhbHNlO1xuICAgIGNvbnN0IHBvcHVsYXRlR2FtZWJvYXJkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBodW1hbkNhcnJpZXIgPSBzaGlwRmFjdG9yeSgnQ2FycmllcicpO1xuICAgICAgICBjb25zdCBodW1hbkJhdHRsZXNoaXAgPSBzaGlwRmFjdG9yeSgnQmF0dGxlc2hpcCcpO1xuICAgICAgICBjb25zdCBodW1hbkRlc3Ryb3llciA9IHNoaXBGYWN0b3J5KCdEZXN0cm95ZXInKTtcbiAgICAgICAgY29uc3QgaHVtYW5TdWJtYXJpbmUgPSBzaGlwRmFjdG9yeSgnU3VibWFyaW5lJyk7XG4gICAgICAgIGNvbnN0IGh1bWFuUGF0cm9sYm9hdCA9IHNoaXBGYWN0b3J5KCdQYXRyb2wgQm9hdCcpO1xuICAgICAgICBjb25zdCBjb21wdXRlckNhcnJpZXIgPSBzaGlwRmFjdG9yeSgnQ2FycmllcicpO1xuICAgICAgICBjb25zdCBjb21wdXRlckJhdHRsZXNoaXAgPSBzaGlwRmFjdG9yeSgnQmF0dGxlc2hpcCcpO1xuICAgICAgICBjb25zdCBjb21wdXRlckRlc3Ryb3llciA9IHNoaXBGYWN0b3J5KCdEZXN0cm95ZXInKTtcbiAgICAgICAgY29uc3QgY29tcHV0ZXJTdWJtYXJpbmUgPSBzaGlwRmFjdG9yeSgnU3VibWFyaW5lJyk7XG4gICAgICAgIGNvbnN0IGNvbXB1dGVyUGF0cm9sYm9hdCA9IHNoaXBGYWN0b3J5KCdQYXRyb2wgQm9hdCcpO1xuICAgICAgICBodW1hbkdhbWVib2FyZC5wbGFjZVNoaXAoaHVtYW5DYXJyaWVyLCAnQScsICcxJywgJ2hvcml6b250YWwnKTtcbiAgICAgICAgaHVtYW5HYW1lYm9hcmQucGxhY2VTaGlwKGh1bWFuQmF0dGxlc2hpcCwgJ0EnLCAnMycsICdob3Jpem9udGFsJyk7XG4gICAgICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hbkRlc3Ryb3llciwgJ0EnLCAnNScsICdob3Jpem9udGFsJyk7XG4gICAgICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hblN1Ym1hcmluZSwgJ0EnLCAnNycsICdob3Jpem9udGFsJyk7XG4gICAgICAgIGh1bWFuR2FtZWJvYXJkLnBsYWNlU2hpcChodW1hblBhdHJvbGJvYXQsICdBJywgJzknLCAnaG9yaXpvbnRhbCcpO1xuICAgICAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoY29tcHV0ZXJDYXJyaWVyLCAnQScsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlckJhdHRsZXNoaXAsICdDJywgJzEnLCAndmVydGljYWwnKTtcbiAgICAgICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKGNvbXB1dGVyRGVzdHJveWVyLCAnRScsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChjb21wdXRlclN1Ym1hcmluZSwgJ0cnLCAnMScsICd2ZXJ0aWNhbCcpO1xuICAgICAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoY29tcHV0ZXJQYXRyb2xib2F0LCAnSScsICcxJywgJ3ZlcnRpY2FsJyk7XG4gICAgfTtcbiAgICBjb25zdCBpc0dhbWVPdmVyID0gKCkgPT4ge1xuICAgICAgICBpZiAoY29tcHV0ZXJHYW1lYm9hcmQuYWxsU3VuaygpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQWxsIGNvbXB1dGVyIHNoaXBzIGFyZSBzdW5rLiBIdW1hbiBwbGF5ZXIgd29uIScpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGh1bWFuR2FtZWJvYXJkLmFsbFN1bmsoKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FsbCBodW1hbiBzaGlwcyBhcmUgc3Vuay4gQ29tcHV0ZXIgcGxheWVyIHdvbiEnKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIGNvbnN0IHBsYXllclZzQ29tcHV0ZXJNb2RlID0gKCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHdoaWxlICghaXNHYW1lT3ZlcigpICYmICFpc1N0b3BwZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgY29sLCByb3cgfSA9IHlpZWxkIHVpLmhhbmRsZVVzZXJJbnB1dCgpO1xuICAgICAgICAgICAgaHVtYW4uYXR0YWNrKGNvbXB1dGVyR2FtZWJvYXJkLCBjb2wsIHJvdyk7XG4gICAgICAgICAgICBjb21wdXRlckdhbWVib2FyZC5zaW5rU2hpcChjb21wdXRlckdhbWVib2FyZCwgY29sLCByb3cpO1xuICAgICAgICAgICAgdWkucmVmcmVzaEJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICAgICAgICAgIHlpZWxkIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgICAgICAgIGlmICghdWkucFZjQnRuLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSB8fCBpc1N0b3BwZWQpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgY29sOiByYW5kb21Db2wsIHJvdzogcmFuZG9tUm93IH0gPSBjb21wdXRlci5yYW5kb21BdHRhY2soaHVtYW5HYW1lYm9hcmQpO1xuICAgICAgICAgICAgaHVtYW5HYW1lYm9hcmQuc2lua1NoaXAoaHVtYW5HYW1lYm9hcmQsIHJhbmRvbUNvbCwgcmFuZG9tUm93KTtcbiAgICAgICAgICAgIHVpLnJlZnJlc2hCb2FyZChodW1hbkdhbWVib2FyZCk7XG4gICAgICAgIH1cbiAgICAgICAgaXNTdG9wcGVkID0gZmFsc2U7XG4gICAgfSk7XG4gICAgY29uc3QgY29tcHV0ZXJWc0NvbXB1dGVyTW9kZSA9ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB3aGlsZSAoIWlzR2FtZU92ZXIoKSAmJiAhaXNTdG9wcGVkKSB7XG4gICAgICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKTtcbiAgICAgICAgICAgIGlmICghdWkuY1ZjQnRuLmNsYXNzTGlzdC5jb250YWlucygnc2VsZWN0ZWQnKSB8fCBpc1N0b3BwZWQpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgY29sOiByYW5kb21Db2wyLCByb3c6IHJhbmRvbVJvdzIgfSA9IGNvbXB1dGVyLnJhbmRvbUF0dGFjayhodW1hbkdhbWVib2FyZCk7XG4gICAgICAgICAgICBodW1hbkdhbWVib2FyZC5zaW5rU2hpcChodW1hbkdhbWVib2FyZCwgcmFuZG9tQ29sMiwgcmFuZG9tUm93Mik7XG4gICAgICAgICAgICB1aS5yZWZyZXNoQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgICAgICAgICAgeWllbGQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgNTAwKSk7XG4gICAgICAgICAgICBpZiAoIXVpLmNWY0J0bi5jbGFzc0xpc3QuY29udGFpbnMoJ3NlbGVjdGVkJykgfHwgaXNTdG9wcGVkKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbDogcmFuZG9tQ29sMSwgcm93OiByYW5kb21Sb3cxIH0gPSBodW1hbi5yYW5kb21BdHRhY2soY29tcHV0ZXJHYW1lYm9hcmQpO1xuICAgICAgICAgICAgY29tcHV0ZXJHYW1lYm9hcmQuc2lua1NoaXAoY29tcHV0ZXJHYW1lYm9hcmQsIHJhbmRvbUNvbDEsIHJhbmRvbVJvdzEpO1xuICAgICAgICAgICAgdWkucmVmcmVzaEJvYXJkKGNvbXB1dGVyR2FtZWJvYXJkKTtcbiAgICAgICAgfVxuICAgICAgICBpc1N0b3BwZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBjb25zdCBwaWNrR2FtZU1vZGUgPSAoKSA9PiB7XG4gICAgICAgIGlmICh1aS5wVmNCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gcGxheWVyVnNDb21wdXRlck1vZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1aS5jVmNCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcHV0ZXJWc0NvbXB1dGVyTW9kZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBzdGFydCA9ICgpID0+IHtcbiAgICAgICAgcG9wdWxhdGVHYW1lYm9hcmQoKTtcbiAgICAgICAgdWkucmVuZGVyQm9hcmQoaHVtYW5HYW1lYm9hcmQpO1xuICAgICAgICB1aS5yZW5kZXJCb2FyZChjb21wdXRlckdhbWVib2FyZCk7XG4gICAgICAgIHBpY2tHYW1lTW9kZSgpO1xuICAgIH07XG4gICAgY29uc3QgcmVzdGFydCA9ICgpID0+IHtcbiAgICAgICAgaHVtYW5HYW1lYm9hcmQuY2xlYXJCb2FyZCgpO1xuICAgICAgICBjb21wdXRlckdhbWVib2FyZC5jbGVhckJvYXJkKCk7XG4gICAgICAgIHBvcHVsYXRlR2FtZWJvYXJkKCk7XG4gICAgICAgIHVpLnJlZnJlc2hCb2FyZChodW1hbkdhbWVib2FyZCk7XG4gICAgICAgIHVpLnJlZnJlc2hCb2FyZChjb21wdXRlckdhbWVib2FyZCk7XG4gICAgICAgIHBpY2tHYW1lTW9kZSgpO1xuICAgIH07XG4gICAgY29uc3QgbmV3R2FtZSA9ICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBpc1N0b3BwZWQgPSB0cnVlO1xuICAgICAgICB5aWVsZCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgICAgIGlzU3RvcHBlZCA9IGZhbHNlO1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHsgc3RhcnQsIGh1bWFuR2FtZWJvYXJkLCBjb21wdXRlckdhbWVib2FyZCwgbmV3R2FtZSwgcmVzdGFydCB9O1xufSkoKTtcbmV4cG9ydCBkZWZhdWx0IGNvbnRyb2xsZXI7XG4iLCJpbXBvcnQgJ25vcm1hbGl6ZS5jc3MnO1xuaW1wb3J0ICcuL3N0eWxlL3N0eWxlLmNzcyc7XG5pbXBvcnQgY29udHJvbGxlciBmcm9tICcuL21vZHVsZXMvY29udHJvbGxlcic7XG5jb250cm9sbGVyLnN0YXJ0KCk7XG4iXSwibmFtZXMiOlsiY29scyIsInJvd3MiLCJhcnJheSIsImdldENlbGwiLCJjb2wiLCJyb3ciLCJjb2xJbmRleCIsImluZGV4T2YiLCJyb3dJbmRleCIsInNldENlbGwiLCJuZXdTdGF0dXMiLCJuZXdUYWtlbkJ5Iiwic3RhdHVzIiwidGFrZW5CeSIsImkiLCJqIiwidW5kZWZpbmVkIiwiZ2VuZXJhdGVBcnJheSIsImNsZWFyQm9hcmQiLCJwbGFjZVNoaXAiLCJzaGlwIiwib3JpZW50YXRpb24iLCJpc0hvcml6b250YWwiLCJjZWxscyIsInN0YXJ0Iiwic2l6ZSIsImxlbmd0aCIsImN1cnJlbnRDb2wiLCJjdXJyZW50Um93IiwicmVjZWl2ZUF0dGFjayIsImNlbGwiLCJoaXQiLCJzaW5rU2hpcCIsImdhbWVib2FyZCIsImlzU3VuayIsImZsYXQiLCJmaWx0ZXIiLCJjIiwibmFtZSIsImZvckVhY2giLCJkaXJlY3Rpb24iLCJuZXdDb2wiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJjaGFyQ29kZUF0IiwibmV3Um93IiwiTnVtYmVyIiwidG9TdHJpbmciLCJhbGxTdW5rIiwiaGl0Q291bnRlciIsImF0dGFjayIsInJhbmRvbUF0dGFjayIsInJhbmRvbUNvbCIsInJhbmRvbVJvdyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNlaWwiLCJyZXN1bHQiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwidWkiLCJ3cmFwcGVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYm9hcmRzIiwiY3JlYXRlRWxlbWVudCIsImlkIiwicHJlcGVuZCIsInBWY0J0biIsImNWY0J0biIsIm5ld0dhbWVCdG4iLCJyZW5kZXJDZWxscyIsImJvYXJkIiwiY2xhc3NMaXN0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwiY3JlYXRlQ2VsbCIsImFwcGVuZCIsImdldFVzZXJJbnB1dCIsInRhcmdldCIsImNvbnRhaW5zIiwiZ2V0QXR0cmlidXRlIiwiaGFuZGxlR2FtZU1vZGUiLCJzZWxlY3RlZEVsZW1lbnQiLCJkZXNlbGVjdGVkRWxlbWVudCIsInJlbW92ZSIsInJlc3RhcnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZGlzYWJsZWQiLCJ0ZXh0Q29udGVudCIsIm5ld0dhbWUiLCJyZW5kZXJCb2FyZCIsImh1bWFuR2FtZWJvYXJkIiwiY29tcHV0ZXJHYW1lYm9hcmQiLCJyZWZyZXNoQm9hcmQiLCJib2FyZElkIiwiaW5uZXJIVE1MIiwiaGFuZGxlVXNlcklucHV0IiwidGhpcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ1c2VySW5wdXQiLCJvbmNlIiwiaHVtYW4iLCJwbGF5ZXIiLCJjb21wdXRlciIsImlzU3RvcHBlZCIsInBvcHVsYXRlR2FtZWJvYXJkIiwiaHVtYW5DYXJyaWVyIiwiaHVtYW5CYXR0bGVzaGlwIiwiaHVtYW5EZXN0cm95ZXIiLCJodW1hblN1Ym1hcmluZSIsImh1bWFuUGF0cm9sYm9hdCIsImNvbXB1dGVyQ2FycmllciIsImNvbXB1dGVyQmF0dGxlc2hpcCIsImNvbXB1dGVyRGVzdHJveWVyIiwiY29tcHV0ZXJTdWJtYXJpbmUiLCJjb21wdXRlclBhdHJvbGJvYXQiLCJpc0dhbWVPdmVyIiwiY29uc29sZSIsImxvZyIsInBpY2tHYW1lTW9kZSIsInNldFRpbWVvdXQiLCJyYW5kb21Db2wyIiwicmFuZG9tUm93MiIsInJhbmRvbUNvbDEiLCJyYW5kb21Sb3cxIl0sInNvdXJjZVJvb3QiOiIifQ==